"""
app/utils/location.py
=====================
ì§€ì—­ëª… ì •ê·œí™”, ë§¤ì¹­ ë° ì§€ë¦¬ì  ê±°ë¦¬ ê³„ì‚° ìœ í‹¸ë¦¬í‹°

* ê¸°ëŠ¥
  1. í•œêµ­ í–‰ì •êµ¬ì—­ ì²´ê³„ë¥¼ ê³ ë ¤í•œ ì§€ì—­ëª… ë§¤ì¹­ ë¡œì§
  2. Haversine ê³µì‹ì„ ì‚¬ìš©í•œ ë‘ ì§€ì  ê°„ ê±°ë¦¬ ê³„ì‚°
  3. ì§€ì—­ëª…ì„ ìœ„ë„/ê²½ë„ ì¢Œí‘œë¡œ ë³€í™˜
  4. ê±°ë¦¬ ê¸°ë°˜ í•„í„°ë§ ë° ì ìˆ˜ ê³„ì‚°
"""

import re
import math
from typing import List, Set, Tuple, Optional, Any


# í•œêµ­ ì£¼ìš” ì§€ì—­ ì¢Œí‘œ ë°ì´í„° (ìœ„ë„, ê²½ë„)
KOREA_LOCATIONS = {
    # ì„œìš¸/ê²½ê¸°
    "ì„œìš¸": (37.5665, 126.9780),
    "ê²½ê¸°": (37.4138, 127.5183),
    "ì¸ì²œ": (37.4563, 126.7052),
    "ìˆ˜ì›": (37.2636, 127.0286),
    "ì„±ë‚¨": (37.4449, 127.1388),
    "ê³ ì–‘": (37.6584, 126.8320),
    
    # ê°•ì›ë„
    "ê°•ì›": (37.8228, 128.1555),
    "ì¶˜ì²œ": (37.8813, 127.7298),
    "ì›ì£¼": (37.3422, 127.9202),
    "ê°•ë¦‰": (37.7519, 128.8761),
    "ì†ì´ˆ": (38.2070, 128.5918),
    
    # ì¶©ì²­ë„
    "ì¶©ë¶": (36.8, 127.7),
    "ì¶©ë‚¨": (36.5, 126.8),
    "ëŒ€ì „": (36.3504, 127.3845),
    "ì²­ì£¼": (36.6424, 127.4890),
    "ì²œì•ˆ": (36.8151, 127.1139),
    "ì¶©ì£¼": (36.9910, 127.9259),
    
    # ì „ë¼ë„
    "ì „ë¶": (35.7175, 127.153),
    "ì „ë‚¨": (34.8679, 126.991),
    "ê´‘ì£¼": (35.1595, 126.8526),
    "ì „ì£¼": (35.8242, 127.1480),
    "êµ°ì‚°": (35.9677, 126.7369),
    "ìµì‚°": (35.9483, 126.9578),
    "ê³ ì°½": (35.4351, 126.7014),
    "ìˆœì²œ": (34.9506, 127.4872),
    "ì—¬ìˆ˜": (34.7604, 127.6622),
    "ëª©í¬": (34.8118, 126.3922),
    
    # ê²½ìƒë„
    "ê²½ë¶": (36.4919, 128.8889),
    "ê²½ë‚¨": (35.4606, 128.2132),
    "ëŒ€êµ¬": (35.8714, 128.6014),
    "ë¶€ì‚°": (35.1796, 129.0756),
    "ìš¸ì‚°": (35.5384, 129.3114),
    "í¬í•­": (36.0190, 129.3435),
    "ê²½ì£¼": (35.8562, 129.2247),
    "ì•ˆë™": (36.5684, 128.7294),
    "ì°½ì›": (35.2281, 128.6811),
    "ê¹€í•´": (35.2342, 128.8890),
    "ì§„ì£¼": (35.1800, 128.1076),
    
    # ì œì£¼ë„
    "ì œì£¼": (33.4996, 126.5312),
    "ì„œê·€í¬": (33.2541, 126.5601),
}


# í•œêµ­ ì‹œë„ëª… ë§¤í•‘
REGION_MAPPING = {
    # ì „ì²´ í˜•íƒœ -> ì•½ì–´
    "ì„œìš¸íŠ¹ë³„ì‹œ": ["ì„œìš¸", "ì„œìš¸ì‹œ"],
    "ë¶€ì‚°ê´‘ì—­ì‹œ": ["ë¶€ì‚°", "ë¶€ì‚°ì‹œ"],
    "ëŒ€êµ¬ê´‘ì—­ì‹œ": ["ëŒ€êµ¬", "ëŒ€êµ¬ì‹œ"],
    "ì¸ì²œê´‘ì—­ì‹œ": ["ì¸ì²œ", "ì¸ì²œì‹œ"],
    "ê´‘ì£¼ê´‘ì—­ì‹œ": ["ê´‘ì£¼", "ê´‘ì£¼ì‹œ"],
    "ëŒ€ì „ê´‘ì—­ì‹œ": ["ëŒ€ì „", "ëŒ€ì „ì‹œ"],
    "ìš¸ì‚°ê´‘ì—­ì‹œ": ["ìš¸ì‚°", "ìš¸ì‚°ì‹œ"],
    "ê²½ê¸°ë„": ["ê²½ê¸°", "ê²½ê¸°ë„"],
    "ê°•ì›ë„": ["ê°•ì›", "ê°•ì›ë„"],
    "ì¶©ì²­ë¶ë„": ["ì¶©ë¶", "ì¶©ì²­ë¶ë„"],
    "ì¶©ì²­ë‚¨ë„": ["ì¶©ë‚¨", "ì¶©ì²­ë‚¨ë„"],
    "ì „ë¼ë¶ë„": ["ì „ë¶", "ì „ë¼ë¶ë„"],
    "ì „ë¼ë‚¨ë„": ["ì „ë‚¨", "ì „ë¼ë‚¨ë„"],
    "ê²½ìƒë¶ë„": ["ê²½ë¶", "ê²½ìƒë¶ë„"],
    "ê²½ìƒë‚¨ë„": ["ê²½ë‚¨", "ê²½ìƒë‚¨ë„"],
    "ì œì£¼íŠ¹ë³„ìì¹˜ë„": ["ì œì£¼", "ì œì£¼ë„"],
}

# ì—­ë§¤í•‘: ì•½ì–´ -> ì „ì²´ í˜•íƒœ
REVERSE_MAPPING = {}
for full_name, aliases in REGION_MAPPING.items():
    for alias in aliases:
        REVERSE_MAPPING[alias] = full_name
    REVERSE_MAPPING[full_name] = full_name

# í•œêµ­ ì£¼ìš” ì‹œ/êµ°/êµ¬ â†’ ì‹œë„ ë§¤í•‘ (ì‹œ/êµ° ë‹¨ìœ„ ì§€ì—­ëª…ë§Œìœ¼ë¡œë„ ì¸ì‹í•˜ë„ë¡)
SIGUNGU_TO_SIDO_MAPPING = {
    # ì„œìš¸íŠ¹ë³„ì‹œ (êµ¬ ë‹¨ìœ„)
    "ê°•ë‚¨êµ¬": "ì„œìš¸", "ê°•ë™êµ¬": "ì„œìš¸", "ê°•ë¶êµ¬": "ì„œìš¸", "ê°•ì„œêµ¬": "ì„œìš¸", 
    "ê´€ì•…êµ¬": "ì„œìš¸", "ê´‘ì§„êµ¬": "ì„œìš¸", "êµ¬ë¡œêµ¬": "ì„œìš¸", "ê¸ˆì²œêµ¬": "ì„œìš¸",
    "ë…¸ì›êµ¬": "ì„œìš¸", "ë„ë´‰êµ¬": "ì„œìš¸", "ë™ëŒ€ë¬¸êµ¬": "ì„œìš¸", "ë™ì‘êµ¬": "ì„œìš¸",
    "ë§ˆí¬êµ¬": "ì„œìš¸", "ì„œëŒ€ë¬¸êµ¬": "ì„œìš¸", "ì„œì´ˆêµ¬": "ì„œìš¸", "ì„±ë™êµ¬": "ì„œìš¸",
    "ì„±ë¶êµ¬": "ì„œìš¸", "ì†¡íŒŒêµ¬": "ì„œìš¸", "ì–‘ì²œêµ¬": "ì„œìš¸", "ì˜ë“±í¬êµ¬": "ì„œìš¸",
    "ìš©ì‚°êµ¬": "ì„œìš¸", "ì€í‰êµ¬": "ì„œìš¸", "ì¢…ë¡œêµ¬": "ì„œìš¸", "ì¤‘êµ¬": "ì„œìš¸", "ì¤‘ë‘êµ¬": "ì„œìš¸",
    
    # ê²½ê¸°ë„
    "ìˆ˜ì›ì‹œ": "ê²½ê¸°", "ìˆ˜ì›": "ê²½ê¸°", "ì„±ë‚¨ì‹œ": "ê²½ê¸°", "ì„±ë‚¨": "ê²½ê¸°",
    "ê³ ì–‘ì‹œ": "ê²½ê¸°", "ê³ ì–‘": "ê²½ê¸°", "ìš©ì¸ì‹œ": "ê²½ê¸°", "ìš©ì¸": "ê²½ê¸°",
    "ë¶€ì²œì‹œ": "ê²½ê¸°", "ë¶€ì²œ": "ê²½ê¸°", "ì•ˆì‚°ì‹œ": "ê²½ê¸°", "ì•ˆì‚°": "ê²½ê¸°",
    "ì•ˆì–‘ì‹œ": "ê²½ê¸°", "ì•ˆì–‘": "ê²½ê¸°", "ë‚¨ì–‘ì£¼ì‹œ": "ê²½ê¸°", "ë‚¨ì–‘ì£¼": "ê²½ê¸°",
    "í™”ì„±ì‹œ": "ê²½ê¸°", "í™”ì„±": "ê²½ê¸°", "í‰íƒì‹œ": "ê²½ê¸°", "í‰íƒ": "ê²½ê¸°",
    "ì˜ì •ë¶€ì‹œ": "ê²½ê¸°", "ì˜ì •ë¶€": "ê²½ê¸°", "ì‹œí¥ì‹œ": "ê²½ê¸°", "ì‹œí¥": "ê²½ê¸°",
    "íŒŒì£¼ì‹œ": "ê²½ê¸°", "íŒŒì£¼": "ê²½ê¸°", "ê´‘ëª…ì‹œ": "ê²½ê¸°", "ê´‘ëª…": "ê²½ê¸°",
    "ê¹€í¬ì‹œ": "ê²½ê¸°", "ê¹€í¬": "ê²½ê¸°", "êµ°í¬ì‹œ": "ê²½ê¸°", "êµ°í¬": "ê²½ê¸°",
    "ê´‘ì£¼ì‹œ": "ê²½ê¸°", "ì´ì²œì‹œ": "ê²½ê¸°", "ì´ì²œ": "ê²½ê¸°", "ì–‘ì£¼ì‹œ": "ê²½ê¸°", "ì–‘ì£¼": "ê²½ê¸°",
    "ì˜¤ì‚°ì‹œ": "ê²½ê¸°", "ì˜¤ì‚°": "ê²½ê¸°", "êµ¬ë¦¬ì‹œ": "ê²½ê¸°", "êµ¬ë¦¬": "ê²½ê¸°",
    "ì•ˆì„±ì‹œ": "ê²½ê¸°", "ì•ˆì„±": "ê²½ê¸°", "í¬ì²œì‹œ": "ê²½ê¸°", "í¬ì²œ": "ê²½ê¸°",
    "ì˜ì™•ì‹œ": "ê²½ê¸°", "ì˜ì™•": "ê²½ê¸°", "í•˜ë‚¨ì‹œ": "ê²½ê¸°", "í•˜ë‚¨": "ê²½ê¸°",
    "ì—¬ì£¼ì‹œ": "ê²½ê¸°", "ì—¬ì£¼": "ê²½ê¸°", "ì–‘í‰êµ°": "ê²½ê¸°", "ì–‘í‰": "ê²½ê¸°",
    "ë™ë‘ì²œì‹œ": "ê²½ê¸°", "ë™ë‘ì²œ": "ê²½ê¸°", "ê³¼ì²œì‹œ": "ê²½ê¸°", "ê³¼ì²œ": "ê²½ê¸°",
    "ê°€í‰êµ°": "ê²½ê¸°", "ê°€í‰": "ê²½ê¸°", "ì—°ì²œêµ°": "ê²½ê¸°", "ì—°ì²œ": "ê²½ê¸°",
    
    # ì¸ì²œê´‘ì—­ì‹œ
    "ì¤‘êµ¬": "ì¸ì²œ", "ë™êµ¬": "ì¸ì²œ", "ë¯¸ì¶”í™€êµ¬": "ì¸ì²œ", "ì—°ìˆ˜êµ¬": "ì¸ì²œ",
    "ë‚¨ë™êµ¬": "ì¸ì²œ", "ë¶€í‰êµ¬": "ì¸ì²œ", "ê³„ì–‘êµ¬": "ì¸ì²œ", "ì„œêµ¬": "ì¸ì²œ",
    "ê°•í™”êµ°": "ì¸ì²œ", "ê°•í™”": "ì¸ì²œ", "ì˜¹ì§„êµ°": "ì¸ì²œ", "ì˜¹ì§„": "ì¸ì²œ",
    
    # ê°•ì›íŠ¹ë³„ìì¹˜ë„
    "ì¶˜ì²œì‹œ": "ê°•ì›", "ì¶˜ì²œ": "ê°•ì›", "ì›ì£¼ì‹œ": "ê°•ì›", "ì›ì£¼": "ê°•ì›",
    "ê°•ë¦‰ì‹œ": "ê°•ì›", "ê°•ë¦‰": "ê°•ì›", "ë™í•´ì‹œ": "ê°•ì›", "ë™í•´": "ê°•ì›",
    "íƒœë°±ì‹œ": "ê°•ì›", "íƒœë°±": "ê°•ì›", "ì†ì´ˆì‹œ": "ê°•ì›", "ì†ì´ˆ": "ê°•ì›",
    "ì‚¼ì²™ì‹œ": "ê°•ì›", "ì‚¼ì²™": "ê°•ì›", "í™ì²œêµ°": "ê°•ì›", "í™ì²œ": "ê°•ì›",
    "íš¡ì„±êµ°": "ê°•ì›", "íš¡ì„±": "ê°•ì›", "ì˜ì›”êµ°": "ê°•ì›", "ì˜ì›”": "ê°•ì›",
    "í‰ì°½êµ°": "ê°•ì›", "í‰ì°½": "ê°•ì›", "ì •ì„ êµ°": "ê°•ì›", "ì •ì„ ": "ê°•ì›",
    "ì² ì›êµ°": "ê°•ì›", "ì² ì›": "ê°•ì›", "í™”ì²œêµ°": "ê°•ì›", "í™”ì²œ": "ê°•ì›",
    "ì–‘êµ¬êµ°": "ê°•ì›", "ì–‘êµ¬": "ê°•ì›", "ì¸ì œêµ°": "ê°•ì›", "ì¸ì œ": "ê°•ì›",
    "ê³ ì„±êµ°": "ê°•ì›", "ê³ ì„±": "ê°•ì›", "ì–‘ì–‘êµ°": "ê°•ì›", "ì–‘ì–‘": "ê°•ì›",
    
    # ì¶©ì²­ë¶ë„
    "ì²­ì£¼ì‹œ": "ì¶©ë¶", "ì²­ì£¼": "ì¶©ë¶", "ì¶©ì£¼ì‹œ": "ì¶©ë¶", "ì¶©ì£¼": "ì¶©ë¶",
    "ì œì²œì‹œ": "ì¶©ë¶", "ì œì²œ": "ì¶©ë¶", "ë³´ì€êµ°": "ì¶©ë¶", "ë³´ì€": "ì¶©ë¶",
    "ì˜¥ì²œêµ°": "ì¶©ë¶", "ì˜¥ì²œ": "ì¶©ë¶", "ì˜ë™êµ°": "ì¶©ë¶", "ì˜ë™": "ì¶©ë¶",
    "ì¦í‰êµ°": "ì¶©ë¶", "ì¦í‰": "ì¶©ë¶", "ì§„ì²œêµ°": "ì¶©ë¶", "ì§„ì²œ": "ì¶©ë¶",
    "ê´´ì‚°êµ°": "ì¶©ë¶", "ê´´ì‚°": "ì¶©ë¶", "ìŒì„±êµ°": "ì¶©ë¶", "ìŒì„±": "ì¶©ë¶",
    "ë‹¨ì–‘êµ°": "ì¶©ë¶", "ë‹¨ì–‘": "ì¶©ë¶", # ì‚¬ìš©ì ì˜ˆì‹œ ë‹¨ì–‘ ì¶”ê°€
    
    # ì¶©ì²­ë‚¨ë„
    "ì²œì•ˆì‹œ": "ì¶©ë‚¨", "ì²œì•ˆ": "ì¶©ë‚¨", "ê³µì£¼ì‹œ": "ì¶©ë‚¨", "ê³µì£¼": "ì¶©ë‚¨",
    "ë³´ë ¹ì‹œ": "ì¶©ë‚¨", "ë³´ë ¹": "ì¶©ë‚¨", "ì•„ì‚°ì‹œ": "ì¶©ë‚¨", "ì•„ì‚°": "ì¶©ë‚¨",
    "ì„œì‚°ì‹œ": "ì¶©ë‚¨", "ì„œì‚°": "ì¶©ë‚¨", "ë…¼ì‚°ì‹œ": "ì¶©ë‚¨", "ë…¼ì‚°": "ì¶©ë‚¨",
    "ê³„ë£¡ì‹œ": "ì¶©ë‚¨", "ê³„ë£¡": "ì¶©ë‚¨", "ë‹¹ì§„ì‹œ": "ì¶©ë‚¨", "ë‹¹ì§„": "ì¶©ë‚¨",
    "ê¸ˆì‚°êµ°": "ì¶©ë‚¨", "ê¸ˆì‚°": "ì¶©ë‚¨", "ë¶€ì—¬êµ°": "ì¶©ë‚¨", "ë¶€ì—¬": "ì¶©ë‚¨",
    "ì„œì²œêµ°": "ì¶©ë‚¨", "ì„œì²œ": "ì¶©ë‚¨", "ì²­ì–‘êµ°": "ì¶©ë‚¨", "ì²­ì–‘": "ì¶©ë‚¨",
    "í™ì„±êµ°": "ì¶©ë‚¨", "í™ì„±": "ì¶©ë‚¨", "ì˜ˆì‚°êµ°": "ì¶©ë‚¨", "ì˜ˆì‚°": "ì¶©ë‚¨",
    "íƒœì•ˆêµ°": "ì¶©ë‚¨", "íƒœì•ˆ": "ì¶©ë‚¨",
    
    # ì „ë¼ë¶ë„
    "ì „ì£¼ì‹œ": "ì „ë¶", "ì „ì£¼": "ì „ë¶", "êµ°ì‚°ì‹œ": "ì „ë¶", "êµ°ì‚°": "ì „ë¶",
    "ìµì‚°ì‹œ": "ì „ë¶", "ìµì‚°": "ì „ë¶", "ì •ìì‹œ": "ì „ë¶", "ì •ì": "ì „ë¶",
    "ë‚¨ì›ì‹œ": "ì „ë¶", "ë‚¨ì›": "ì „ë¶", "ê¹€ì œì‹œ": "ì „ë¶", "ê¹€ì œ": "ì „ë¶",
    "ì™„ì£¼êµ°": "ì „ë¶", "ì™„ì£¼": "ì „ë¶", "ì§„ì•ˆêµ°": "ì „ë¶", "ì§„ì•ˆ": "ì „ë¶",
    "ë¬´ì£¼êµ°": "ì „ë¶", "ë¬´ì£¼": "ì „ë¶", "ì¥ìˆ˜êµ°": "ì „ë¶", "ì¥ìˆ˜": "ì „ë¶",
    "ì„ì‹¤êµ°": "ì „ë¶", "ì„ì‹¤": "ì „ë¶", "ìˆœì°½êµ°": "ì „ë¶", "ìˆœì°½": "ì „ë¶",
    "ê³ ì°½êµ°": "ì „ë¶", "ê³ ì°½": "ì „ë¶", "ë¶€ì•ˆêµ°": "ì „ë¶", "ë¶€ì•ˆ": "ì „ë¶",
    
    # ì „ë¼ë‚¨ë„
    "ëª©í¬ì‹œ": "ì „ë‚¨", "ëª©í¬": "ì „ë‚¨", "ì—¬ìˆ˜ì‹œ": "ì „ë‚¨", "ì—¬ìˆ˜": "ì „ë‚¨",
    "ìˆœì²œì‹œ": "ì „ë‚¨", "ìˆœì²œ": "ì „ë‚¨", "ë‚˜ì£¼ì‹œ": "ì „ë‚¨", "ë‚˜ì£¼": "ì „ë‚¨",
    "ê´‘ì–‘ì‹œ": "ì „ë‚¨", "ê´‘ì–‘": "ì „ë‚¨", "ë‹´ì–‘êµ°": "ì „ë‚¨", "ë‹´ì–‘": "ì „ë‚¨",
    "ê³¡ì„±êµ°": "ì „ë‚¨", "ê³¡ì„±": "ì „ë‚¨", "êµ¬ë¡€êµ°": "ì „ë‚¨", "êµ¬ë¡€": "ì „ë‚¨",
    "ê³ í¥êµ°": "ì „ë‚¨", "ê³ í¥": "ì „ë‚¨", "ë³´ì„±êµ°": "ì „ë‚¨", "ë³´ì„±": "ì „ë‚¨",
    "í™”ìˆœêµ°": "ì „ë‚¨", "í™”ìˆœ": "ì „ë‚¨", "ì¥í¥êµ°": "ì „ë‚¨", "ì¥í¥": "ì „ë‚¨",
    "ê°•ì§„êµ°": "ì „ë‚¨", "ê°•ì§„": "ì „ë‚¨", "í•´ë‚¨êµ°": "ì „ë‚¨", "í•´ë‚¨": "ì „ë‚¨",
    "ì˜ì•”êµ°": "ì „ë‚¨", "ì˜ì•”": "ì „ë‚¨", "ë¬´ì•ˆêµ°": "ì „ë‚¨", "ë¬´ì•ˆ": "ì „ë‚¨",
    "í•¨í‰êµ°": "ì „ë‚¨", "í•¨í‰": "ì „ë‚¨", "ì˜ê´‘êµ°": "ì „ë‚¨", "ì˜ê´‘": "ì „ë‚¨",
    "ì¥ì„±êµ°": "ì „ë‚¨", "ì¥ì„±": "ì „ë‚¨", "ì™„ë„êµ°": "ì „ë‚¨", "ì™„ë„": "ì „ë‚¨",
    "ì§„ë„êµ°": "ì „ë‚¨", "ì§„ë„": "ì „ë‚¨", "ì‹ ì•ˆêµ°": "ì „ë‚¨", "ì‹ ì•ˆ": "ì „ë‚¨",
    
    # ê²½ìƒë¶ë„
    "í¬í•­ì‹œ": "ê²½ë¶", "í¬í•­": "ê²½ë¶", "ê²½ì£¼ì‹œ": "ê²½ë¶", "ê²½ì£¼": "ê²½ë¶",
    "ê¹€ì²œì‹œ": "ê²½ë¶", "ê¹€ì²œ": "ê²½ë¶", "ì•ˆë™ì‹œ": "ê²½ë¶", "ì•ˆë™": "ê²½ë¶",
    "êµ¬ë¯¸ì‹œ": "ê²½ë¶", "êµ¬ë¯¸": "ê²½ë¶", "ì˜ì£¼ì‹œ": "ê²½ë¶", "ì˜ì£¼": "ê²½ë¶",
    "ì˜ì²œì‹œ": "ê²½ë¶", "ì˜ì²œ": "ê²½ë¶", "ìƒì£¼ì‹œ": "ê²½ë¶", "ìƒì£¼": "ê²½ë¶",
    "ë¬¸ê²½ì‹œ": "ê²½ë¶", "ë¬¸ê²½": "ê²½ë¶", "ê²½ì‚°ì‹œ": "ê²½ë¶", "ê²½ì‚°": "ê²½ë¶",
    "êµ°ìœ„êµ°": "ê²½ë¶", "êµ°ìœ„": "ê²½ë¶", "ì˜ì„±êµ°": "ê²½ë¶", "ì˜ì„±": "ê²½ë¶",
    "ì²­ì†¡êµ°": "ê²½ë¶", "ì²­ì†¡": "ê²½ë¶", "ì˜ì–‘êµ°": "ê²½ë¶", "ì˜ì–‘": "ê²½ë¶",
    "ì˜ë•êµ°": "ê²½ë¶", "ì˜ë•": "ê²½ë¶", "ì²­ë„êµ°": "ê²½ë¶", "ì²­ë„": "ê²½ë¶",
    "ê³ ë ¹êµ°": "ê²½ë¶", "ê³ ë ¹": "ê²½ë¶", "ì„±ì£¼êµ°": "ê²½ë¶", "ì„±ì£¼": "ê²½ë¶",
    "ì¹ ê³¡êµ°": "ê²½ë¶", "ì¹ ê³¡": "ê²½ë¶", "ì˜ˆì²œêµ°": "ê²½ë¶", "ì˜ˆì²œ": "ê²½ë¶",
    "ë´‰í™”êµ°": "ê²½ë¶", "ë´‰í™”": "ê²½ë¶", "ìš¸ì§„êµ°": "ê²½ë¶", "ìš¸ì§„": "ê²½ë¶",
    "ìš¸ë¦‰êµ°": "ê²½ë¶", "ìš¸ë¦‰": "ê²½ë¶",
    
    # ê²½ìƒë‚¨ë„
    "ì°½ì›ì‹œ": "ê²½ë‚¨", "ì°½ì›": "ê²½ë‚¨", "ì§„ì£¼ì‹œ": "ê²½ë‚¨", "ì§„ì£¼": "ê²½ë‚¨",
    "í†µì˜ì‹œ": "ê²½ë‚¨", "í†µì˜": "ê²½ë‚¨", "ì‚¬ì²œì‹œ": "ê²½ë‚¨", "ì‚¬ì²œ": "ê²½ë‚¨",
    "ê¹€í•´ì‹œ": "ê²½ë‚¨", "ê¹€í•´": "ê²½ë‚¨", "ë°€ì–‘ì‹œ": "ê²½ë‚¨", "ë°€ì–‘": "ê²½ë‚¨",
    "ê±°ì œì‹œ": "ê²½ë‚¨", "ê±°ì œ": "ê²½ë‚¨", "ì–‘ì‚°ì‹œ": "ê²½ë‚¨", "ì–‘ì‚°": "ê²½ë‚¨",
    "ì˜ë ¹êµ°": "ê²½ë‚¨", "ì˜ë ¹": "ê²½ë‚¨", "í•¨ì•ˆêµ°": "ê²½ë‚¨", "í•¨ì•ˆ": "ê²½ë‚¨",
    "ì°½ë…•êµ°": "ê²½ë‚¨", "ì°½ë…•": "ê²½ë‚¨", "ê³ ì„±êµ°": "ê²½ë‚¨", "ë‚¨í•´êµ°": "ê²½ë‚¨", "ë‚¨í•´": "ê²½ë‚¨",
    "í•˜ë™êµ°": "ê²½ë‚¨", "í•˜ë™": "ê²½ë‚¨", "ì‚°ì²­êµ°": "ê²½ë‚¨", "ì‚°ì²­": "ê²½ë‚¨",
    "í•¨ì–‘êµ°": "ê²½ë‚¨", "í•¨ì–‘": "ê²½ë‚¨", "ê±°ì°½êµ°": "ê²½ë‚¨", "ê±°ì°½": "ê²½ë‚¨",
    "í•©ì²œêµ°": "ê²½ë‚¨", "í•©ì²œ": "ê²½ë‚¨",
    
    # ëŒ€êµ¬ê´‘ì—­ì‹œ
    "ì¤‘êµ¬": "ëŒ€êµ¬", "ë™êµ¬": "ëŒ€êµ¬", "ì„œêµ¬": "ëŒ€êµ¬", "ë‚¨êµ¬": "ëŒ€êµ¬",
    "ë¶êµ¬": "ëŒ€êµ¬", "ìˆ˜ì„±êµ¬": "ëŒ€êµ¬", "ë‹¬ì„œêµ¬": "ëŒ€êµ¬", "ë‹¬ì„±êµ°": "ëŒ€êµ¬", "ë‹¬ì„±": "ëŒ€êµ¬",
    
    # ë¶€ì‚°ê´‘ì—­ì‹œ
    "ì¤‘êµ¬": "ë¶€ì‚°", "ì„œêµ¬": "ë¶€ì‚°", "ë™êµ¬": "ë¶€ì‚°", "ì˜ë„êµ¬": "ë¶€ì‚°",
    "ë¶€ì‚°ì§„êµ¬": "ë¶€ì‚°", "ë™ë˜êµ¬": "ë¶€ì‚°", "ë‚¨êµ¬": "ë¶€ì‚°", "ë¶êµ¬": "ë¶€ì‚°",
    "í•´ìš´ëŒ€êµ¬": "ë¶€ì‚°", "ì‚¬í•˜êµ¬": "ë¶€ì‚°", "ê¸ˆì •êµ¬": "ë¶€ì‚°", "ê°•ì„œêµ¬": "ë¶€ì‚°",
    "ì—°ì œêµ¬": "ë¶€ì‚°", "ìˆ˜ì˜êµ¬": "ë¶€ì‚°", "ì‚¬ìƒêµ¬": "ë¶€ì‚°", "ê¸°ì¥êµ°": "ë¶€ì‚°", "ê¸°ì¥": "ë¶€ì‚°",
    
    # ìš¸ì‚°ê´‘ì—­ì‹œ
    "ì¤‘êµ¬": "ìš¸ì‚°", "ë‚¨êµ¬": "ìš¸ì‚°", "ë™êµ¬": "ìš¸ì‚°", "ë¶êµ¬": "ìš¸ì‚°",
    "ìš¸ì£¼êµ°": "ìš¸ì‚°", "ìš¸ì£¼": "ìš¸ì‚°",
    
    # ê´‘ì£¼ê´‘ì—­ì‹œ
    "ë™êµ¬": "ê´‘ì£¼", "ì„œêµ¬": "ê´‘ì£¼", "ë‚¨êµ¬": "ê´‘ì£¼", "ë¶êµ¬": "ê´‘ì£¼", "ê´‘ì‚°êµ¬": "ê´‘ì£¼",
    
    # ëŒ€ì „ê´‘ì—­ì‹œ
    "ë™êµ¬": "ëŒ€ì „", "ì¤‘êµ¬": "ëŒ€ì „", "ì„œêµ¬": "ëŒ€ì „", "ìœ ì„±êµ¬": "ëŒ€ì „", "ëŒ€ë•êµ¬": "ëŒ€ì „",
    
    # ì œì£¼íŠ¹ë³„ìì¹˜ë„
    "ì œì£¼ì‹œ": "ì œì£¼", "ì„œê·€í¬ì‹œ": "ì œì£¼", "ì„œê·€í¬": "ì œì£¼",
}

# ê°•í™”ëœ ì§€ì—­ëª… ì •ê·œí™” ë§¤í•‘ í…Œì´ë¸” - ëª¨ë“  ì…ë ¥ ë³€í˜• ëŒ€ì‘
COMPREHENSIVE_REGION_MAPPING = {
    # ì¶©ì²­ë„ ë§¤í•‘ ê°•í™” (ì‚¬ìš©ì í•µì‹¬ ìš”êµ¬ì‚¬í•­)
    "ì¶©ì²­ë„": ["ì¶©ì²­ë¶ë„", "ì¶©ì²­ë‚¨ë„", "ì¶©ë¶", "ì¶©ë‚¨", "ëŒ€ì „", "ì„¸ì¢…", "ì¶©ì²­", "ì²­ì£¼", "ëŒ€ì „", "ì²œì•ˆ", "ì¶©ì£¼"],
    "ì¶©ì²­": ["ì¶©ì²­ë„", "ì¶©ì²­ë¶ë„", "ì¶©ì²­ë‚¨ë„", "ì¶©ë¶", "ì¶©ë‚¨", "ëŒ€ì „", "ì„¸ì¢…"],
    "ì¶©ë¶": ["ì¶©ì²­ë¶ë„", "ì¶©ì²­ë„", "ì¶©ì²­", "ì²­ì£¼", "ì¶©ì£¼", "ì œì²œ", "ë‹¨ì–‘", "ìŒì„±", "ì§„ì²œ", "ê´´ì‚°", "ì¦í‰", "ì˜ë™", "ì˜¥ì²œ", "ë³´ì€"],
    "ì¶©ì²­ë¶ë„": ["ì¶©ë¶", "ì¶©ì²­ë„", "ì¶©ì²­", "ì²­ì£¼", "ì¶©ì£¼", "ì œì²œ", "ë‹¨ì–‘", "ìŒì„±", "ì§„ì²œ", "ê´´ì‚°", "ì¦í‰", "ì˜ë™", "ì˜¥ì²œ", "ë³´ì€"],
    "ì¶©ë‚¨": ["ì¶©ì²­ë‚¨ë„", "ì¶©ì²­ë„", "ì¶©ì²­", "ì²œì•ˆ", "ê³µì£¼", "ë³´ë ¹", "ì•„ì‚°", "ì„œì‚°", "ë…¼ì‚°", "ê³„ë£¡", "ë‹¹ì§„", "ê¸ˆì‚°", "ë¶€ì—¬", "ì„œì²œ", "ì²­ì–‘", "í™ì„±", "ì˜ˆì‚°", "íƒœì•ˆ"],
    "ì¶©ì²­ë‚¨ë„": ["ì¶©ë‚¨", "ì¶©ì²­ë„", "ì¶©ì²­", "ì²œì•ˆ", "ê³µì£¼", "ë³´ë ¹", "ì•„ì‚°", "ì„œì‚°", "ë…¼ì‚°", "ê³„ë£¡", "ë‹¹ì§„", "ê¸ˆì‚°", "ë¶€ì—¬", "ì„œì²œ", "ì²­ì–‘", "í™ì„±", "ì˜ˆì‚°", "íƒœì•ˆ"],
    
    # ì „ë¼ë„ ë§¤í•‘ ê°•í™”
    "ì „ë¼ë„": ["ì „ë¼ë¶ë„", "ì „ë¼ë‚¨ë„", "ì „ë¶", "ì „ë‚¨", "ê´‘ì£¼", "ì „ì£¼", "êµ°ì‚°", "ìµì‚°", "ëª©í¬", "ì—¬ìˆ˜", "ìˆœì²œ"],
    "ì „ë¼": ["ì „ë¼ë„", "ì „ë¼ë¶ë„", "ì „ë¼ë‚¨ë„", "ì „ë¶", "ì „ë‚¨", "ê´‘ì£¼"],
    "ì „ë¶": ["ì „ë¼ë¶ë„", "ì „ë¶íŠ¹ë³„ìì¹˜ë„", "ì „ë¼ë„", "ì „ë¼", "ì „ì£¼", "êµ°ì‚°", "ìµì‚°", "ì •ì", "ë‚¨ì›", "ê¹€ì œ", "ì™„ì£¼", "ì§„ì•ˆ", "ë¬´ì£¼", "ì¥ìˆ˜", "ì„ì‹¤", "ìˆœì°½", "ê³ ì°½", "ë¶€ì•ˆ"],
    "ì „ë¼ë¶ë„": ["ì „ë¶", "ì „ë¶íŠ¹ë³„ìì¹˜ë„", "ì „ë¼ë„", "ì „ë¼", "ì „ì£¼", "êµ°ì‚°", "ìµì‚°", "ì •ì", "ë‚¨ì›", "ê¹€ì œ", "ì™„ì£¼", "ì§„ì•ˆ", "ë¬´ì£¼", "ì¥ìˆ˜", "ì„ì‹¤", "ìˆœì°½", "ê³ ì°½", "ë¶€ì•ˆ"],
    "ì „ë¶íŠ¹ë³„ìì¹˜ë„": ["ì „ë¶", "ì „ë¼ë¶ë„", "ì „ë¼ë„", "ì „ë¼", "ì „ì£¼", "êµ°ì‚°", "ìµì‚°", "ì •ì", "ë‚¨ì›", "ê¹€ì œ", "ì™„ì£¼", "ì§„ì•ˆ", "ë¬´ì£¼", "ì¥ìˆ˜", "ì„ì‹¤", "ìˆœì°½", "ê³ ì°½", "ë¶€ì•ˆ"],
    "ì „ë‚¨": ["ì „ë¼ë‚¨ë„", "ì „ë¼ë„", "ì „ë¼", "ëª©í¬", "ì—¬ìˆ˜", "ìˆœì²œ", "ë‚˜ì£¼", "ê´‘ì–‘", "ë‹´ì–‘", "ê³¡ì„±", "êµ¬ë¡€", "ê³ í¥", "ë³´ì„±", "í™”ìˆœ", "ì¥í¥", "ê°•ì§„", "í•´ë‚¨", "ì˜ì•”", "ë¬´ì•ˆ", "í•¨í‰", "ì˜ê´‘", "ì¥ì„±", "ì™„ë„", "ì§„ë„", "ì‹ ì•ˆ"],
    "ì „ë¼ë‚¨ë„": ["ì „ë‚¨", "ì „ë¼ë„", "ì „ë¼", "ëª©í¬", "ì—¬ìˆ˜", "ìˆœì²œ", "ë‚˜ì£¼", "ê´‘ì–‘", "ë‹´ì–‘", "ê³¡ì„±", "êµ¬ë¡€", "ê³ í¥", "ë³´ì„±", "í™”ìˆœ", "ì¥í¥", "ê°•ì§„", "í•´ë‚¨", "ì˜ì•”", "ë¬´ì•ˆ", "í•¨í‰", "ì˜ê´‘", "ì¥ì„±", "ì™„ë„", "ì§„ë„", "ì‹ ì•ˆ"],
    
    # ê²½ìƒë„ ë§¤í•‘ ê°•í™”
    "ê²½ìƒë„": ["ê²½ìƒë¶ë„", "ê²½ìƒë‚¨ë„", "ê²½ë¶", "ê²½ë‚¨", "ëŒ€êµ¬", "ë¶€ì‚°", "ìš¸ì‚°", "í¬í•­", "ê²½ì£¼", "ì•ˆë™", "ì°½ì›", "ì§„ì£¼"],
    "ê²½ìƒ": ["ê²½ìƒë„", "ê²½ìƒë¶ë„", "ê²½ìƒë‚¨ë„", "ê²½ë¶", "ê²½ë‚¨"],
    "ê²½ë¶": ["ê²½ìƒë¶ë„", "ê²½ìƒë„", "ê²½ìƒ", "í¬í•­", "ê²½ì£¼", "ê¹€ì²œ", "ì•ˆë™", "êµ¬ë¯¸", "ì˜ì£¼", "ì˜ì²œ", "ìƒì£¼", "ë¬¸ê²½", "ê²½ì‚°"],
    "ê²½ìƒë¶ë„": ["ê²½ë¶", "ê²½ìƒë„", "ê²½ìƒ", "í¬í•­", "ê²½ì£¼", "ê¹€ì²œ", "ì•ˆë™", "êµ¬ë¯¸", "ì˜ì£¼", "ì˜ì²œ", "ìƒì£¼", "ë¬¸ê²½", "ê²½ì‚°"],
    "ê²½ë‚¨": ["ê²½ìƒë‚¨ë„", "ê²½ìƒë„", "ê²½ìƒ", "ì°½ì›", "ì§„ì£¼", "í†µì˜", "ì‚¬ì²œ", "ê¹€í•´", "ë°€ì–‘", "ê±°ì œ", "ì–‘ì‚°"],
    "ê²½ìƒë‚¨ë„": ["ê²½ë‚¨", "ê²½ìƒë„", "ê²½ìƒ", "ì°½ì›", "ì§„ì£¼", "í†µì˜", "ì‚¬ì²œ", "ê¹€í•´", "ë°€ì–‘", "ê±°ì œ", "ì–‘ì‚°"],
    
    # ì œì£¼ë„ ë§¤í•‘ ê°•í™”
    "ì œì£¼ë„": ["ì œì£¼", "ì œì£¼íŠ¹ë³„ìì¹˜ë„", "ì œì£¼ì‹œ", "ì„œê·€í¬", "ì œì£¼ ì œì£¼", "ì œì£¼ ì„œê·€í¬"],
    "ì œì£¼": ["ì œì£¼ë„", "ì œì£¼íŠ¹ë³„ìì¹˜ë„", "ì œì£¼ì‹œ", "ì„œê·€í¬", "ì œì£¼ ì œì£¼", "ì œì£¼ ì„œê·€í¬"],
    "ì œì£¼íŠ¹ë³„ìì¹˜ë„": ["ì œì£¼", "ì œì£¼ë„", "ì œì£¼ì‹œ", "ì„œê·€í¬", "ì œì£¼ ì œì£¼", "ì œì£¼ ì„œê·€í¬"],
    "ì„œê·€í¬": ["ì œì£¼", "ì œì£¼ë„", "ì œì£¼íŠ¹ë³„ìì¹˜ë„", "ì œì£¼ ì„œê·€í¬"],
    
    # ê°•ì›ë„ ë§¤í•‘ ê°•í™”
    "ê°•ì›ë„": ["ê°•ì›", "ê°•ì›íŠ¹ë³„ìì¹˜ë„", "ì¶˜ì²œ", "ì›ì£¼", "ê°•ë¦‰", "ì†ì´ˆ", "í‰ì°½", "í™ì²œ", "íš¡ì„±", "ì •ì„ ", "ì˜ì›”", "íƒœë°±", "ì‚¼ì²™", "ë™í•´"],
    "ê°•ì›": ["ê°•ì›ë„", "ê°•ì›íŠ¹ë³„ìì¹˜ë„", "ì¶˜ì²œ", "ì›ì£¼", "ê°•ë¦‰", "ì†ì´ˆ", "í‰ì°½", "í™ì²œ", "íš¡ì„±", "ì •ì„ ", "ì˜ì›”", "íƒœë°±", "ì‚¼ì²™", "ë™í•´"],
    "ê°•ì›íŠ¹ë³„ìì¹˜ë„": ["ê°•ì›", "ê°•ì›ë„", "ì¶˜ì²œ", "ì›ì£¼", "ê°•ë¦‰", "ì†ì´ˆ", "í‰ì°½", "í™ì²œ", "íš¡ì„±", "ì •ì„ ", "ì˜ì›”", "íƒœë°±", "ì‚¼ì²™", "ë™í•´"],
    
    # ê²½ê¸°ë„ ë§¤í•‘ ê°•í™”
    "ê²½ê¸°ë„": ["ê²½ê¸°", "ìˆ˜ì›", "ì„±ë‚¨", "ê³ ì–‘", "ìš©ì¸", "ë¶€ì²œ", "ì•ˆì‚°", "ì•ˆì–‘", "ë‚¨ì–‘ì£¼", "í™”ì„±", "í‰íƒ", "ì˜ì •ë¶€", "ì‹œí¥", "íŒŒì£¼", "ê´‘ëª…", "ê¹€í¬", "êµ°í¬", "ì´ì²œ", "ì–‘ì£¼", "ì˜¤ì‚°", "êµ¬ë¦¬", "ì•ˆì„±", "í¬ì²œ", "ì˜ì™•", "í•˜ë‚¨", "ì—¬ì£¼", "ì–‘í‰", "ë™ë‘ì²œ", "ê³¼ì²œ", "ê°€í‰", "ì—°ì²œ"],
    "ê²½ê¸°": ["ê²½ê¸°ë„", "ìˆ˜ì›", "ì„±ë‚¨", "ê³ ì–‘", "ìš©ì¸", "ë¶€ì²œ", "ì•ˆì‚°", "ì•ˆì–‘", "ë‚¨ì–‘ì£¼", "í™”ì„±", "í‰íƒ", "ì˜ì •ë¶€", "ì‹œí¥", "íŒŒì£¼", "ê´‘ëª…", "ê¹€í¬", "êµ°í¬", "ì´ì²œ", "ì–‘ì£¼", "ì˜¤ì‚°", "êµ¬ë¦¬", "ì•ˆì„±", "í¬ì²œ", "ì˜ì™•", "í•˜ë‚¨", "ì—¬ì£¼", "ì–‘í‰", "ë™ë‘ì²œ", "ê³¼ì²œ", "ê°€í‰", "ì—°ì²œ"],
    
    # ì£¼ìš” ê´‘ì—­ì‹œ ë§¤í•‘
    "ì„œìš¸": ["ì„œìš¸íŠ¹ë³„ì‹œ", "ì„œìš¸ì‹œ"],
    "ì„œìš¸íŠ¹ë³„ì‹œ": ["ì„œìš¸", "ì„œìš¸ì‹œ"], 
    "ì„œìš¸ì‹œ": ["ì„œìš¸", "ì„œìš¸íŠ¹ë³„ì‹œ"],
    "ë¶€ì‚°": ["ë¶€ì‚°ê´‘ì—­ì‹œ", "ë¶€ì‚°ì‹œ"],
    "ë¶€ì‚°ê´‘ì—­ì‹œ": ["ë¶€ì‚°", "ë¶€ì‚°ì‹œ"],
    "ë¶€ì‚°ì‹œ": ["ë¶€ì‚°", "ë¶€ì‚°ê´‘ì—­ì‹œ"],
    "ëŒ€êµ¬": ["ëŒ€êµ¬ê´‘ì—­ì‹œ", "ëŒ€êµ¬ì‹œ"],
    "ëŒ€êµ¬ê´‘ì—­ì‹œ": ["ëŒ€êµ¬", "ëŒ€êµ¬ì‹œ"],
    "ëŒ€êµ¬ì‹œ": ["ëŒ€êµ¬", "ëŒ€êµ¬ê´‘ì—­ì‹œ"],
    "ì¸ì²œ": ["ì¸ì²œê´‘ì—­ì‹œ", "ì¸ì²œì‹œ"],
    "ì¸ì²œê´‘ì—­ì‹œ": ["ì¸ì²œ", "ì¸ì²œì‹œ"],
    "ì¸ì²œì‹œ": ["ì¸ì²œ", "ì¸ì²œê´‘ì—­ì‹œ"],
    "ê´‘ì£¼": ["ê´‘ì£¼ê´‘ì—­ì‹œ", "ê´‘ì£¼ì‹œ"],
    "ê´‘ì£¼ê´‘ì—­ì‹œ": ["ê´‘ì£¼", "ê´‘ì£¼ì‹œ"],
    "ê´‘ì£¼ì‹œ": ["ê´‘ì£¼", "ê´‘ì£¼ê´‘ì—­ì‹œ"],
    "ëŒ€ì „": ["ëŒ€ì „ê´‘ì—­ì‹œ", "ëŒ€ì „ì‹œ"],
    "ëŒ€ì „ê´‘ì—­ì‹œ": ["ëŒ€ì „", "ëŒ€ì „ì‹œ"],
    "ëŒ€ì „ì‹œ": ["ëŒ€ì „", "ëŒ€ì „ê´‘ì—­ì‹œ"],
    "ìš¸ì‚°": ["ìš¸ì‚°ê´‘ì—­ì‹œ", "ìš¸ì‚°ì‹œ"],
    "ìš¸ì‚°ê´‘ì—­ì‹œ": ["ìš¸ì‚°", "ìš¸ì‚°ì‹œ"],
    "ìš¸ì‚°ì‹œ": ["ìš¸ì‚°", "ìš¸ì‚°ê´‘ì—­ì‹œ"],
    "ì„¸ì¢…": ["ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ", "ì„¸ì¢…ì‹œ"],
    "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ": ["ì„¸ì¢…", "ì„¸ì¢…ì‹œ"],
    "ì„¸ì¢…ì‹œ": ["ì„¸ì¢…", "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ"],
    
    # ì „ë¼ë¶ë„ ë§¤í•‘ ê°•í™”
    "ì „ë¶": ["ì „ë¼ë¶ë„", "ì „ë¶íŠ¹ë³„ìì¹˜ë„", "ì „ë¶ ì „ì£¼", "ì „ë¶ êµ°ì‚°", "ì „ë¶ ìµì‚°", "ì „ë¶ ê³ ì°½", "ì „ë¶ ê¹€ì œ", "ì „ë¶ ë‚¨ì›", "ì „ë¶ ì •ì", "ì „ë¶ ë¶€ì•ˆ", "ì „ë¶ ë¬´ì£¼", "ì „ì£¼", "êµ°ì‚°", "ìµì‚°", "ê³ ì°½", "ê¹€ì œ", "ë‚¨ì›", "ì •ì", "ë¶€ì•ˆ", "ë¬´ì£¼"],
    "ì „ë¼ë¶ë„": ["ì „ë¶", "ì „ë¶íŠ¹ë³„ìì¹˜ë„", "ì „ë¶ ì „ì£¼", "ì „ë¶ êµ°ì‚°", "ì „ë¶ ìµì‚°", "ì „ë¶ ê³ ì°½", "ì „ë¶ ê¹€ì œ", "ì „ë¶ ë‚¨ì›", "ì „ë¶ ì •ì", "ì „ë¶ ë¶€ì•ˆ", "ì „ë¶ ë¬´ì£¼", "ì „ì£¼", "êµ°ì‚°", "ìµì‚°", "ê³ ì°½", "ê¹€ì œ", "ë‚¨ì›", "ì •ì", "ë¶€ì•ˆ", "ë¬´ì£¼"],
    "ì „ë¶íŠ¹ë³„ìì¹˜ë„": ["ì „ë¶", "ì „ë¼ë¶ë„", "ì „ë¶ ì „ì£¼", "ì „ë¶ êµ°ì‚°", "ì „ë¶ ìµì‚°", "ì „ë¶ ê³ ì°½", "ì „ë¶ ê¹€ì œ", "ì „ë¶ ë‚¨ì›", "ì „ë¶ ì •ì", "ì „ë¶ ë¶€ì•ˆ", "ì „ë¶ ë¬´ì£¼", "ì „ì£¼", "êµ°ì‚°", "ìµì‚°", "ê³ ì°½", "ê¹€ì œ", "ë‚¨ì›", "ì •ì", "ë¶€ì•ˆ", "ë¬´ì£¼"],
    "ì „ì£¼": ["ì „ë¶", "ì „ë¼ë¶ë„", "ì „ë¶íŠ¹ë³„ìì¹˜ë„", "ì „ë¶ ì „ì£¼"],
    "êµ°ì‚°": ["ì „ë¶", "ì „ë¼ë¶ë„", "ì „ë¶íŠ¹ë³„ìì¹˜ë„", "ì „ë¶ êµ°ì‚°"],
    "ìµì‚°": ["ì „ë¶", "ì „ë¼ë¶ë„", "ì „ë¶íŠ¹ë³„ìì¹˜ë„", "ì „ë¶ ìµì‚°"],
    "ê³ ì°½": ["ì „ë¶", "ì „ë¼ë¶ë„", "ì „ë¶íŠ¹ë³„ìì¹˜ë„", "ì „ë¶ ê³ ì°½"],
    "ë‚¨ì›": ["ì „ë¶", "ì „ë¼ë¶ë„", "ì „ë¶íŠ¹ë³„ìì¹˜ë„", "ì „ë¶ ë‚¨ì›"],
    "ë¬´ì£¼": ["ì „ë¶", "ì „ë¼ë¶ë„", "ì „ë¶íŠ¹ë³„ìì¹˜ë„", "ì „ë¶ ë¬´ì£¼"],
    
    # ê¸°íƒ€ ì‹œë„ ë§¤í•‘ ê°•í™”
    "ê²½ê¸°ë„": ["ê²½ê¸°", "ê²½ê¸° ìˆ˜ì›", "ê²½ê¸° ì„±ë‚¨", "ê²½ê¸° ê³ ì–‘", "ê²½ê¸° ê°€í‰", "ê²½ê¸° ì•ˆì„±", "ìˆ˜ì›", "ì„±ë‚¨", "ê³ ì–‘", "ì•ˆì„±", "ê°€í‰"],
    "ê²½ê¸°": ["ê²½ê¸°ë„", "ê²½ê¸° ìˆ˜ì›", "ê²½ê¸° ì„±ë‚¨", "ê²½ê¸° ê³ ì–‘", "ê²½ê¸° ê°€í‰", "ê²½ê¸° ì•ˆì„±", "ìˆ˜ì›", "ì„±ë‚¨", "ê³ ì–‘", "ì•ˆì„±", "ê°€í‰"],
    "ìˆ˜ì›": ["ê²½ê¸°", "ê²½ê¸°ë„", "ê²½ê¸° ìˆ˜ì›"],
    "ì„±ë‚¨": ["ê²½ê¸°", "ê²½ê¸°ë„", "ê²½ê¸° ì„±ë‚¨"],
    "ê³ ì–‘": ["ê²½ê¸°", "ê²½ê¸°ë„", "ê²½ê¸° ê³ ì–‘"],
    "ì•ˆì„±": ["ê²½ê¸°", "ê²½ê¸°ë„", "ê²½ê¸° ì•ˆì„±"],
    "ê°€í‰": ["ê²½ê¸°", "ê²½ê¸°ë„", "ê²½ê¸° ê°€í‰"],
    
    "ì¶©ë‚¨": ["ì¶©ì²­ë‚¨ë„", "ì¶©ë‚¨ ë…¼ì‚°", "ì¶©ë‚¨ ì²œì•ˆ", "ì¶©ë‚¨ ì„œì‚°", "ë…¼ì‚°", "ì²œì•ˆ", "ì„œì‚°"],
    "ì¶©ì²­ë‚¨ë„": ["ì¶©ë‚¨", "ì¶©ë‚¨ ë…¼ì‚°", "ì¶©ë‚¨ ì²œì•ˆ", "ì¶©ë‚¨ ì„œì‚°", "ë…¼ì‚°", "ì²œì•ˆ", "ì„œì‚°"],
    "ë…¼ì‚°": ["ì¶©ë‚¨", "ì¶©ì²­ë‚¨ë„", "ì¶©ë‚¨ ë…¼ì‚°"],
    "ì²œì•ˆ": ["ì¶©ë‚¨", "ì¶©ì²­ë‚¨ë„", "ì¶©ë‚¨ ì²œì•ˆ"],
    "ì„œì‚°": ["ì¶©ë‚¨", "ì¶©ì²­ë‚¨ë„", "ì¶©ë‚¨ ì„œì‚°"],
    
    "ì „ë‚¨": ["ì „ë¼ë‚¨ë„", "ì „ë‚¨ ë‹´ì–‘", "ì „ë‚¨ ì¥ì„±", "ì „ë‚¨ ë‚˜ì£¼", "ì „ë‚¨ ë¬´ì•ˆ", "ë‹´ì–‘", "ì¥ì„±", "ë‚˜ì£¼", "ë¬´ì•ˆ"],
    "ì „ë¼ë‚¨ë„": ["ì „ë‚¨", "ì „ë‚¨ ë‹´ì–‘", "ì „ë‚¨ ì¥ì„±", "ì „ë‚¨ ë‚˜ì£¼", "ì „ë‚¨ ë¬´ì•ˆ", "ë‹´ì–‘", "ì¥ì„±", "ë‚˜ì£¼", "ë¬´ì•ˆ"],
    "ë‚˜ì£¼": ["ì „ë‚¨", "ì „ë¼ë‚¨ë„", "ì „ë‚¨ ë‚˜ì£¼"],
    "ë¬´ì•ˆ": ["ì „ë‚¨", "ì „ë¼ë‚¨ë„", "ì „ë‚¨ ë¬´ì•ˆ"],
    
    "ê²½ë¶": ["ê²½ìƒë¶ë„", "ê²½ë¶ ê²½ì‚°", "ê²½ë¶ ì•ˆë™", "ê²½ë¶ ê²½ì£¼", "ê²½ë¶ ì˜ì²œ", "ì•ˆë™", "ê²½ì£¼", "ê²½ì‚°", "ì˜ì²œ"],
    "ê²½ìƒë¶ë„": ["ê²½ë¶", "ê²½ë¶ ê²½ì‚°", "ê²½ë¶ ì•ˆë™", "ê²½ë¶ ê²½ì£¼", "ê²½ë¶ ì˜ì²œ", "ì•ˆë™", "ê²½ì£¼", "ê²½ì‚°", "ì˜ì²œ"],
    "ì•ˆë™": ["ê²½ë¶", "ê²½ìƒë¶ë„", "ê²½ë¶ ì•ˆë™"],
    "ê²½ì£¼": ["ê²½ë¶", "ê²½ìƒë¶ë„", "ê²½ë¶ ê²½ì£¼"],
    "ì˜ì²œ": ["ê²½ë¶", "ê²½ìƒë¶ë„", "ê²½ë¶ ì˜ì²œ"],
    
    "ê²½ë‚¨": ["ê²½ìƒë‚¨ë„", "ê²½ë‚¨ ì°½ì›", "ê²½ë‚¨ ë°€ì–‘", "ì°½ì›", "ë°€ì–‘"],
    "ê²½ìƒë‚¨ë„": ["ê²½ë‚¨", "ê²½ë‚¨ ì°½ì›", "ê²½ë‚¨ ë°€ì–‘", "ì°½ì›", "ë°€ì–‘"],
    "ì°½ì›": ["ê²½ë‚¨", "ê²½ìƒë‚¨ë„", "ê²½ë‚¨ ì°½ì›"],
    "ë°€ì–‘": ["ê²½ë‚¨", "ê²½ìƒë‚¨ë„", "ê²½ë‚¨ ë°€ì–‘"],
    
    "ë¶€ì‚°": ["ë¶€ì‚°ê´‘ì—­ì‹œ", "ë¶€ì‚°ì‹œ", "ë¶€ì‚° ì—°ì œêµ¬", "ë¶€ì‚° ê°•ì„œêµ¬"],
    "ë¶€ì‚°ê´‘ì—­ì‹œ": ["ë¶€ì‚°", "ë¶€ì‚°ì‹œ", "ë¶€ì‚° ì—°ì œêµ¬", "ë¶€ì‚° ê°•ì„œêµ¬"],
    "ì¸ì²œ": ["ì¸ì²œê´‘ì—­ì‹œ", "ì¸ì²œì‹œ", "ì¸ì²œ ì„œêµ¬"],
    "ì¸ì²œê´‘ì—­ì‹œ": ["ì¸ì²œ", "ì¸ì²œì‹œ", "ì¸ì²œ ì„œêµ¬"],
}


def calculate_distance(lat1: float, lon1: float, lat2: float, lon2: float) -> float:
    """
    Haversine ê³µì‹ì„ ì‚¬ìš©í•˜ì—¬ ë‘ ì¢Œí‘œ ê°„ì˜ ê±°ë¦¬ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
    
    Parameters
    ----------
    lat1, lon1 : float
        ì²« ë²ˆì§¸ ì§€ì ì˜ ìœ„ë„, ê²½ë„
    lat2, lon2 : float
        ë‘ ë²ˆì§¸ ì§€ì ì˜ ìœ„ë„, ê²½ë„
        
    Returns
    -------
    float
        ë‘ ì§€ì  ê°„ì˜ ê±°ë¦¬ (km)
    """
    # ì§€êµ¬ ë°˜ì§€ë¦„ (km)
    R = 6371.0
    
    # ìœ„ë„, ê²½ë„ë¥¼ ë¼ë””ì•ˆìœ¼ë¡œ ë³€í™˜
    lat1_rad = math.radians(lat1)
    lon1_rad = math.radians(lon1)
    lat2_rad = math.radians(lat2)
    lon2_rad = math.radians(lon2)
    
    # ìœ„ë„, ê²½ë„ ì°¨ì´
    dlat = lat2_rad - lat1_rad
    dlon = lon2_rad - lon1_rad
    
    # Haversine ê³µì‹
    a = math.sin(dlat/2)**2 + math.cos(lat1_rad) * math.cos(lat2_rad) * math.sin(dlon/2)**2
    c = 2 * math.atan2(math.sqrt(a), math.sqrt(1-a))
    
    distance = R * c
    return distance


def get_location_coords(region_name: str) -> Optional[Tuple[float, float]]:
    """
    ì§€ì—­ëª…ì—ì„œ ìœ„ë„/ê²½ë„ ì¢Œí‘œë¥¼ ì°¾ìŠµë‹ˆë‹¤.
    
    Parameters
    ----------
    region_name : str
        ì§€ì—­ëª… (ì˜ˆ: "ì „ë¶ ê³ ì°½", "ì„œìš¸", "ë¶€ì‚°" ë“±)
        
    Returns
    -------
    Optional[Tuple[float, float]]
        (ìœ„ë„, ê²½ë„) ë˜ëŠ” None (ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš°)
    """
    if not region_name:
        return None
    
    # ê³µë°±ê³¼ íŠ¹ìˆ˜ë¬¸ì ì œê±°í•˜ì—¬ ì •ê·œí™”
    normalized = re.sub(r'[^\wê°€-í£]', '', region_name)
    
    # ì •í™•í•œ ë§¤ì¹˜ ë¨¼ì € ì‹œë„
    if normalized in KOREA_LOCATIONS:
        return KOREA_LOCATIONS[normalized]
    
    # ë¶€ë¶„ ë§¤ì¹˜ ì‹œë„ (ì˜ˆ: "ì „ë¶ ê³ ì°½" â†’ "ê³ ì°½")
    for location, coords in KOREA_LOCATIONS.items():
        if location in normalized or normalized in location:
            return coords
    
    # íŒ¨í„´ ë§¤ì¹˜ (ì˜ˆ: "ì „ë¶" í¬í•¨ ì‹œ ì „ë¶ ì¢Œí‘œ ë°˜í™˜)
    region_patterns = [
        ("ì„œìš¸", ["ì„œìš¸"]),
        ("ê²½ê¸°", ["ê²½ê¸°", "ìˆ˜ì›", "ì„±ë‚¨", "ê³ ì–‘"]),
        ("ì¸ì²œ", ["ì¸ì²œ"]),
        ("ê°•ì›", ["ê°•ì›", "ì¶˜ì²œ", "ì›ì£¼", "ê°•ë¦‰", "ì†ì´ˆ"]),
        ("ì¶©ë¶", ["ì¶©ë¶", "ì²­ì£¼", "ì¶©ì£¼"]),
        ("ì¶©ë‚¨", ["ì¶©ë‚¨", "ì²œì•ˆ"]),
        ("ëŒ€ì „", ["ëŒ€ì „"]),
        ("ì „ë¶", ["ì „ë¶", "ì „ì£¼", "êµ°ì‚°", "ìµì‚°", "ê³ ì°½"]),
        ("ì „ë‚¨", ["ì „ë‚¨", "ìˆœì²œ", "ì—¬ìˆ˜", "ëª©í¬"]),
        ("ê´‘ì£¼", ["ê´‘ì£¼"]),
        ("ê²½ë¶", ["ê²½ë¶", "í¬í•­", "ê²½ì£¼", "ì•ˆë™"]),
        ("ê²½ë‚¨", ["ê²½ë‚¨", "ì°½ì›", "ê¹€í•´", "ì§„ì£¼"]),
        ("ëŒ€êµ¬", ["ëŒ€êµ¬"]),
        ("ë¶€ì‚°", ["ë¶€ì‚°"]),
        ("ìš¸ì‚°", ["ìš¸ì‚°"]),
        ("ì œì£¼", ["ì œì£¼", "ì„œê·€í¬"]),
    ]
    
    for region_key, patterns in region_patterns:
        for pattern in patterns:
            if pattern in normalized:
                return KOREA_LOCATIONS.get(region_key)
    
    return None


def filter_by_distance(
    items: List[Any], 
    user_coords: Tuple[float, float], 
    max_distance_km: float = 100.0,
    lat_field: str = "lat",
    lon_field: str = "lon"
) -> List[Tuple[Any, float]]:
    """
    ê±°ë¦¬ ê¸°ì¤€ìœ¼ë¡œ ì•„ì´í…œë“¤ì„ í•„í„°ë§í•˜ê³  ê±°ë¦¬ì™€ í•¨ê»˜ ë°˜í™˜í•©ë‹ˆë‹¤.
    
    Parameters
    ----------
    items : List[Any]
        í•„í„°ë§í•  ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ (JobPost, TourSpot ë“±)
    user_coords : Tuple[float, float]
        ì‚¬ìš©ì ìœ„ì¹˜ (ìœ„ë„, ê²½ë„)
    max_distance_km : float, default=100.0
        ìµœëŒ€ ê±°ë¦¬ (km)
    lat_field : str, default="lat"
        ìœ„ë„ í•„ë“œëª…
    lon_field : str, default="lon"
        ê²½ë„ í•„ë“œëª…
        
    Returns
    -------
    List[Tuple[Any, float]]
        (ì•„ì´í…œ, ê±°ë¦¬) íŠœí”Œ ë¦¬ìŠ¤íŠ¸, ê±°ë¦¬ìˆœìœ¼ë¡œ ì •ë ¬
    """
    user_lat, user_lon = user_coords
    results = []
    
    for item in items:
        # ì•„ì´í…œì˜ ìœ„ë„/ê²½ë„ ì¶”ì¶œ
        item_lat = getattr(item, lat_field, None)
        item_lon = getattr(item, lon_field, None)
        
        if item_lat is None or item_lon is None:
            continue
        
        # ê±°ë¦¬ ê³„ì‚°
        distance = calculate_distance(user_lat, user_lon, item_lat, item_lon)
        
        # ìµœëŒ€ ê±°ë¦¬ ë‚´ì— ìˆëŠ” ê²½ìš°ë§Œ í¬í•¨
        if distance <= max_distance_km:
            results.append((item, distance))
    
    # ê±°ë¦¬ìˆœìœ¼ë¡œ ì •ë ¬
    results.sort(key=lambda x: x[1])
    return results


def calculate_location_score(distance_km: float, max_distance_km: float = 100.0) -> float:
    """
    ê±°ë¦¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìœ„ì¹˜ ì ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
    
    Parameters
    ----------
    distance_km : float
        ê±°ë¦¬ (km)
    max_distance_km : float, default=100.0
        ìµœëŒ€ ê±°ë¦¬ (km)
        
    Returns
    -------
    float
        ìœ„ì¹˜ ì ìˆ˜ (0.0 ~ 1.0, ê°€ê¹Œìš¸ìˆ˜ë¡ ë†’ìŒ)
    """
    if distance_km >= max_distance_km:
        return 0.0
    
    # ì„ í˜• ê°ì†Œ: ê±°ë¦¬ 0km = 1.0, max_distance_km = 0.0
    return max(0.0, 1.0 - (distance_km / max_distance_km))


def parse_region(region_text: str) -> Tuple[Optional[str], Optional[str]]:
    """
    ì§€ì—­ í…ìŠ¤íŠ¸ë¥¼ ì‹œë„ì™€ ì‹œêµ°êµ¬ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤.
    
    Parameters
    ----------
    region_text : str
        ì§€ì—­ í…ìŠ¤íŠ¸ (ì˜ˆ: "ì „ë¶ ê³ ì°½", "ì„œìš¸", "ê²½ê¸° ìˆ˜ì›")
        
    Returns
    -------
    Tuple[Optional[str], Optional[str]]
        (ì‹œë„, ì‹œêµ°êµ¬) íŠœí”Œ
    """
    if not region_text:
        return None, None
    
    # ê³µë°±ìœ¼ë¡œ ë¶„ë¦¬
    parts = region_text.strip().split()
    
    if len(parts) == 1:
        # "ì„œìš¸", "ë¶€ì‚°" ë“± ê´‘ì—­ì‹œì¸ ê²½ìš°
        return parts[0], None
    elif len(parts) >= 2:
        # "ì „ë¶ ê³ ì°½", "ê²½ê¸° ìˆ˜ì›" ë“±
        return parts[0], parts[1]
    
    return None, None


def match_region_strict(target_region: str, user_regions: List[str]) -> Tuple[bool, float]:
    """
    ì‚¬ìš©ìê°€ ì§€ì •í•œ ì§€ì—­ê³¼ ëŒ€ìƒ ì§€ì—­ì˜ ì •í™•í•œ ë§¤ì¹­ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
    ë°ì´í„°ì˜ ë‹¤ì–‘í•œ ì§€ì—­ í‘œê¸° í˜•ì‹ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
    
    Parameters
    ----------
    target_region : str
        ëŒ€ìƒ ì§€ì—­ (DBì˜ region í•„ë“œê°’, ì˜ˆ: "ì „ë¶ ê³ ì°½", "ì „ë¼ë‚¨ë„", "ê°•ì›íŠ¹ë³„ìì¹˜ë„")
    user_regions : List[str]
        ì‚¬ìš©ìê°€ ì§€ì •í•œ ì§€ì—­ ë¦¬ìŠ¤íŠ¸
        
    Returns
    -------
    Tuple[bool, float]
        (ë§¤ì¹­ ì—¬ë¶€, ë§¤ì¹­ ì ìˆ˜ 0.0~1.0)
    """
    if not user_regions or not target_region:
        return False, 0.0
    
    # ëŒ€ìƒ ì§€ì—­ ì •ê·œí™”
    target_normalized = normalize_region_text(target_region)
    
    for user_region in user_regions:
        user_normalized = normalize_region_text(user_region)
        
        # 1ë‹¨ê³„: ì •í™•í•œ ë§¤ì¹­
        if target_normalized == user_normalized:
            return True, 1.0
        
        # 2ë‹¨ê³„: ì‹œë„ ë ˆë²¨ ë§¤ì¹­
        target_sido = extract_sido(target_normalized)
        user_sido = extract_sido(user_normalized)
        
        if target_sido and user_sido and target_sido == user_sido:
            # ì‹œêµ°êµ¬ ì •ë³´ í™•ì¸
            target_sigungu = extract_sigungu(target_normalized)
            user_sigungu = extract_sigungu(user_normalized)
            
            if target_sigungu and user_sigungu and target_sigungu == user_sigungu:
                return True, 1.0  # ì‹œë„+ì‹œêµ°êµ¬ ì™„ì „ ë§¤ì¹­
            elif user_sigungu is None:
                return True, 0.8  # ì‹œë„ë§Œ ë§¤ì¹­ (ì‚¬ìš©ìê°€ ì‹œêµ°êµ¬ ì§€ì • ì•ˆí•¨)
            elif target_sigungu is None:
                return True, 0.7  # ëŒ€ìƒì— ì‹œêµ°êµ¬ ì •ë³´ ì—†ìŒ
        
        # 3ë‹¨ê³„: ë¶€ë¶„ ë§¤ì¹­ (ë¬¸ìì—´ í¬í•¨)
        if target_normalized in user_normalized or user_normalized in target_normalized:
            return True, 0.6
    
    return False, 0.0


def get_region_expansion_levels(user_regions: List[str]) -> List[Tuple[str, float]]:
    """
    ì‚¬ìš©ì ì§€ì—­ì„ ê¸°ì¤€ìœ¼ë¡œ í™•ì¥ ë ˆë²¨ì„ ìƒì„±í•©ë‹ˆë‹¤.
    
    Parameters
    ----------
    user_regions : List[str]
        ì‚¬ìš©ìê°€ ì§€ì •í•œ ì§€ì—­ ë¦¬ìŠ¤íŠ¸
        
    Returns
    -------
    List[Tuple[str, float]]
        (í™•ì¥ëœ_ì§€ì—­_íŒ¨í„´, ê°€ì¤‘ì¹˜) ë¦¬ìŠ¤íŠ¸
    """
    expansion_levels = []
    
    for user_region in user_regions:
        sido, sigungu = parse_region(user_region)
        
        if sido and sigungu:
            # 1ë‹¨ê³„: ì •í™•í•œ ì§€ì—­ (ì˜ˆ: "ì „ë¶ ê³ ì°½")
            expansion_levels.append((f"{sido} {sigungu}", 1.0))
            # 2ë‹¨ê³„: ê°™ì€ ì‹œë„ (ì˜ˆ: "ì „ë¶")
            expansion_levels.append((sido, 0.7))
        elif sido:
            # ì‹œë„ë§Œ ì§€ì •ëœ ê²½ìš°
            expansion_levels.append((sido, 0.9))
    
    # ì¤‘ë³µ ì œê±°í•˜ë©´ì„œ ë†’ì€ ê°€ì¤‘ì¹˜ ìœ ì§€
    unique_levels = {}
    for pattern, weight in expansion_levels:
        if pattern not in unique_levels or unique_levels[pattern] < weight:
            unique_levels[pattern] = weight
    
    # ê°€ì¤‘ì¹˜ ìˆœìœ¼ë¡œ ì •ë ¬
    return sorted(unique_levels.items(), key=lambda x: x[1], reverse=True)


def normalize_region_names(region_list: List[str]) -> Set[str]:
    """
    ì§€ì—­ëª… ë¦¬ìŠ¤íŠ¸ë¥¼ ì •ê·œí™”í•˜ì—¬ ê°€ëŠ¥í•œ ëª¨ë“  ë§¤ì¹­ íŒ¨í„´ ë°˜í™˜.
    
    Args:
        region_list: ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì§€ì—­ëª… ë¦¬ìŠ¤íŠ¸ (ì˜ˆ: ["ì „ë¶ ê³ ì°½"])
        
    Returns:
        ì •ê·œí™”ëœ ì§€ì—­ëª… ì§‘í•© (ì˜ˆ: {"ì „ë¶", "ì „ë¼ë¶ë„", "ê³ ì°½", "ê³ ì°½êµ°"})
    """
    normalized = set()
    
    for region in region_list:
        # ê³µë°±ìœ¼ë¡œ ë¶„ë¦¬ëœ ì§€ì—­ëª… ì²˜ë¦¬ (ì˜ˆ: "ì „ë¶ ê³ ì°½" -> ["ì „ë¶", "ê³ ì°½"])
        parts = region.strip().split()
        
        for part in parts:
            # ê¸°ë³¸ ì§€ì—­ëª… ì¶”ê°€
            normalized.add(part)
            
            # ì‹œë„ëª… ì •ê·œí™”
            if part in REVERSE_MAPPING:
                full_name = REVERSE_MAPPING[part]
                normalized.add(full_name)
                # í•´ë‹¹ ì‹œë„ì˜ ëª¨ë“  ë³„ì¹­ë„ ì¶”ê°€
                normalized.update(REGION_MAPPING.get(full_name, []))
            
            # êµ°/êµ¬/ì‹œ ì ‘ë¯¸ì‚¬ ì²˜ë¦¬
            for suffix in ["êµ°", "êµ¬", "ì‹œ"]:
                if not part.endswith(suffix):
                    normalized.add(f"{part}{suffix}")
                else:
                    # ì ‘ë¯¸ì‚¬ ì œê±°í•œ ë²„ì „ë„ ì¶”ê°€
                    base = part[:-len(suffix)]
                    if base:
                        normalized.add(base)
    
    return normalized


def build_region_filter_condition(region_prefs: List[str]) -> str:
    """
    ì§€ì—­ ì„ í˜¸ë„ë¥¼ SQL WHERE ì¡°ê±´ìœ¼ë¡œ ë³€í™˜.
    
    Args:
        region_prefs: ìŠ¬ë¡¯ì—ì„œ ì¶”ì¶œëœ ì§€ì—­ ì„ í˜¸ë„ ë¦¬ìŠ¤íŠ¸
        
    Returns:
        SQL WHERE ì¡°ê±´ ë¬¸ìì—´
    """
    if not region_prefs:
        return "1=1"  # ì§€ì—­ í•„í„°ë§ ì—†ìŒ
        
    normalized_regions = normalize_region_names(region_prefs)
    
    # ILIKE ì¡°ê±´ë“¤ ìƒì„± (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ, ë¶€ë¶„ ë§¤ì¹­)
    conditions = []
    for region in normalized_regions:
        conditions.append(f"region ILIKE '%{region}%'")
    
    return "(" + " OR ".join(conditions) + ")"


def calculate_region_match_score(item_region: str, preferred_regions: List[str]) -> float:
    """
    ì•„ì´í…œì˜ ì§€ì—­ê³¼ ì‚¬ìš©ì ì„ í˜¸ ì§€ì—­ ê°„ì˜ ë§¤ì¹­ ì ìˆ˜ ê³„ì‚°.
    
    Args:
        item_region: ë°ì´í„°ë² ì´ìŠ¤ì˜ ì§€ì—­ í•„ë“œê°’
        preferred_regions: ì‚¬ìš©ìê°€ ì„ í˜¸í•˜ëŠ” ì§€ì—­ ë¦¬ìŠ¤íŠ¸
        
    Returns:
        ë§¤ì¹­ ì ìˆ˜ (0.0 ~ 1.0, ë†’ì„ìˆ˜ë¡ ë” ì í•©)
    """
    if not preferred_regions or not item_region:
        return 0.5  # ì¤‘ë¦½ì  ì ìˆ˜
        
    normalized_prefs = normalize_region_names(preferred_regions)
    item_region_lower = item_region.lower()
    
    # ì •í™•í•œ ë§¤ì¹­
    for pref in normalized_prefs:
        if pref.lower() in item_region_lower:
            return 1.0
            
    # ë¶€ë¶„ ë§¤ì¹­ ì ìˆ˜ ê³„ì‚°
    max_score = 0.0
    for pref in normalized_prefs:
        pref_lower = pref.lower()
        # ê³µí†µ ë¬¸ì ë¹„ìœ¨ ê³„ì‚°
        common_chars = set(pref_lower) & set(item_region_lower)
        if common_chars:
            score = len(common_chars) / max(len(pref_lower), len(item_region_lower))
            max_score = max(max_score, score * 0.7)  # ë¶€ë¶„ ë§¤ì¹­ì€ 70% ì ìˆ˜
            
    return max_score


def normalize_region_text(region_text: str) -> str:
    """
    ì§€ì—­ í…ìŠ¤íŠ¸ë¥¼ ì •ê·œí™”í•©ë‹ˆë‹¤.
    """
    if not region_text:
        return ""
    
    # ê³µë°± ì œê±° ë° ì†Œë¬¸ì ë³€í™˜
    normalized = re.sub(r'\s+', '', region_text.strip())
    
    # íŠ¹ë³„ìì¹˜ë„ â†’ ë„ ë³€í™˜
    normalized = re.sub(r'íŠ¹ë³„ìì¹˜ë„$', 'ë„', normalized)
    
    # ê´‘ì—­ì‹œ â†’ ì‹œ ë³€í™˜  
    normalized = re.sub(r'ê´‘ì—­ì‹œ$', 'ì‹œ', normalized)
    
    # íŠ¹ë³„ì‹œ â†’ ì‹œ ë³€í™˜
    normalized = re.sub(r'íŠ¹ë³„ì‹œ$', 'ì‹œ', normalized)
    
    return normalized


def extract_sido_from_sigungu(region_text: str) -> Optional[str]:
    """
    ì‹œ/êµ°/êµ¬ ë‹¨ìœ„ ì§€ì—­ëª…ì—ì„œ ì‹œë„ëª…ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
    """
    if not region_text:
        return None
    
    # ê³µë°± ë° ì ‘ë¯¸ì‚¬ ì œê±°í•˜ì—¬ ì •ê·œí™”
    normalized = region_text.strip()
    
    # ì§ì ‘ ë§¤í•‘ì—ì„œ ì°¾ê¸°
    if normalized in SIGUNGU_TO_SIDO_MAPPING:
        return SIGUNGU_TO_SIDO_MAPPING[normalized]
    
    # ì ‘ë¯¸ì‚¬ ì œê±° í›„ ë‹¤ì‹œ ì‹œë„
    for suffix in ["ì‹œ", "êµ°", "êµ¬"]:
        if normalized.endswith(suffix):
            base_name = normalized[:-len(suffix)]
            if base_name in SIGUNGU_TO_SIDO_MAPPING:
                return SIGUNGU_TO_SIDO_MAPPING[base_name]
    
    return None


def extract_sido(region_text: str) -> Optional[str]:
    """
    ì§€ì—­ í…ìŠ¤íŠ¸ì—ì„œ ì‹œë„ëª…ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
    ì‹œë„ëª…ì´ ëª…ì‹œë˜ì§€ ì•Šì€ ê²½ìš° ì‹œ/êµ°/êµ¬ì—ì„œ ì¶”ë¡ í•©ë‹ˆë‹¤.
    """
    if not region_text:
        return None
    
    # 1ë‹¨ê³„: ì „ì²´ ì‹œë„ëª… ë§¤í•‘ (ì •í™•í•œ ë§¤ì¹­ ìš°ì„ )
    sido_mapping = {
        'ì„œìš¸íŠ¹ë³„ì‹œ': 'ì„œìš¸', 'ì„œìš¸ì‹œ': 'ì„œìš¸', 'ì„œìš¸': 'ì„œìš¸',
        'ë¶€ì‚°ê´‘ì—­ì‹œ': 'ë¶€ì‚°', 'ë¶€ì‚°ì‹œ': 'ë¶€ì‚°', 'ë¶€ì‚°': 'ë¶€ì‚°',
        'ëŒ€êµ¬ê´‘ì—­ì‹œ': 'ëŒ€êµ¬', 'ëŒ€êµ¬ì‹œ': 'ëŒ€êµ¬', 'ëŒ€êµ¬': 'ëŒ€êµ¬',
        'ì¸ì²œê´‘ì—­ì‹œ': 'ì¸ì²œ', 'ì¸ì²œì‹œ': 'ì¸ì²œ', 'ì¸ì²œ': 'ì¸ì²œ',
        'ê´‘ì£¼ê´‘ì—­ì‹œ': 'ê´‘ì£¼', 'ê´‘ì£¼ì‹œ': 'ê´‘ì£¼', 'ê´‘ì£¼': 'ê´‘ì£¼',
        'ëŒ€ì „ê´‘ì—­ì‹œ': 'ëŒ€ì „', 'ëŒ€ì „ì‹œ': 'ëŒ€ì „', 'ëŒ€ì „': 'ëŒ€ì „',
        'ìš¸ì‚°ê´‘ì—­ì‹œ': 'ìš¸ì‚°', 'ìš¸ì‚°ì‹œ': 'ìš¸ì‚°', 'ìš¸ì‚°': 'ìš¸ì‚°',
        'ê²½ê¸°ë„': 'ê²½ê¸°', 'ê²½ê¸°': 'ê²½ê¸°',
        'ê°•ì›íŠ¹ë³„ìì¹˜ë„': 'ê°•ì›', 'ê°•ì›ë„': 'ê°•ì›', 'ê°•ì›': 'ê°•ì›',
        'ì¶©ì²­ë¶ë„': 'ì¶©ë¶', 'ì¶©ë¶': 'ì¶©ë¶',
        'ì¶©ì²­ë‚¨ë„': 'ì¶©ë‚¨', 'ì¶©ë‚¨': 'ì¶©ë‚¨',
        'ì „ë¼ë¶ë„': 'ì „ë¶', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„': 'ì „ë¶', 'ì „ë¶': 'ì „ë¶',
        'ì „ë¼ë‚¨ë„': 'ì „ë‚¨', 'ì „ë‚¨': 'ì „ë‚¨',
        'ê²½ìƒë¶ë„': 'ê²½ë¶', 'ê²½ë¶': 'ê²½ë¶',
        'ê²½ìƒë‚¨ë„': 'ê²½ë‚¨', 'ê²½ë‚¨': 'ê²½ë‚¨',
        'ì œì£¼íŠ¹ë³„ìì¹˜ë„': 'ì œì£¼', 'ì œì£¼ë„': 'ì œì£¼', 'ì œì£¼': 'ì œì£¼'
    }
    
    # ì •í™•í•œ ë§¤ì¹­ ìš°ì„ 
    for full_name, short_name in sido_mapping.items():
        if region_text.startswith(full_name):
            return short_name
    
    # 2ë‹¨ê³„: íŒ¨í„´ ë§¤ì¹­ (ê¸°ì¡´ ë¡œì§)
    sido_patterns = [
        r'^ì„œìš¸', r'^ë¶€ì‚°', r'^ëŒ€êµ¬', r'^ì¸ì²œ', r'^ê´‘ì£¼', r'^ëŒ€ì „', r'^ìš¸ì‚°',
        r'^ê²½ê¸°', r'^ê°•ì›', r'^ì¶©ë¶', r'^ì¶©ë‚¨', r'^ì „ë¶', r'^ì „ë‚¨', r'^ê²½ë¶', r'^ê²½ë‚¨', r'^ì œì£¼'
    ]
    
    for pattern in sido_patterns:
        if re.search(pattern, region_text):
            match = re.search(pattern, region_text)
            return match.group()
    
    # 3ë‹¨ê³„: ì‹œ/êµ°/êµ¬ì—ì„œ ì‹œë„ ì¶”ë¡  (ìƒˆ ê¸°ëŠ¥)
    sido_from_sigungu = extract_sido_from_sigungu(region_text)
    if sido_from_sigungu:
        return sido_from_sigungu
    
    return None


def extract_sigungu(region_text: str) -> Optional[str]:
    """
    ì§€ì—­ í…ìŠ¤íŠ¸ì—ì„œ ì‹œêµ°êµ¬ëª…ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
    """
    if not region_text:
        return None
    
    # ì‹œë„ëª… ì œê±° í›„ ë‚˜ë¨¸ì§€ ë¶€ë¶„ì´ ì‹œêµ°êµ¬
    sido = extract_sido(region_text)
    if sido:
        remaining = region_text.replace(sido, '', 1).strip()
        if remaining:
            return remaining
    
    return None


def is_region_match(target_region: str, user_regions: List[str]) -> Tuple[bool, float]:
    """
    í¬ê´„ì ì¸ ì§€ì—­ ë§¤ì¹­ í•¨ìˆ˜.
    
    Args:
        target_region: ë°ì´í„°ë² ì´ìŠ¤ì˜ ì§€ì—­ (ì˜ˆ: "ì œì£¼íŠ¹ë³„ìì¹˜ë„", "ê°•ì› ê°•ë¦‰")
        user_regions: ì‚¬ìš©ì ì…ë ¥ ì§€ì—­ (ì˜ˆ: ["ì œì£¼ë„"], ["ê°•ì›ë„"])
        
    Returns:
        (ë§¤ì¹­ì—¬ë¶€, ì‹ ë¢°ë„ì ìˆ˜)
    """
    if not user_regions or not target_region:
        return False, 0.0
    
    # ì •ê·œí™”
    target_normalized = normalize_region_text(target_region)
    
    for user_region in user_regions:
        user_normalized = normalize_region_text(user_region)
        
        # 1ë‹¨ê³„: ì •í™•í•œ ë¬¸ìì—´ ë§¤ì¹­
        if user_normalized in target_normalized or target_normalized in user_normalized:
            return True, 1.0
        
        # 2ë‹¨ê³„: í¬ê´„ì  ë§¤í•‘ í…Œì´ë¸” ê²€ìƒ‰
        if user_region in COMPREHENSIVE_REGION_MAPPING:
            for mapped_region in COMPREHENSIVE_REGION_MAPPING[user_region]:
                if mapped_region in target_region or normalize_region_text(mapped_region) in target_normalized:
                    return True, 0.9
        
        # 3ë‹¨ê³„: ì‹œë„ ë ˆë²¨ ë§¤ì¹­
        target_sido = extract_sido(target_region)
        user_sido = extract_sido(user_region)
        
        if target_sido and user_sido:
            if target_sido == user_sido:
                return True, 0.8
            # ì‹œë„ ë³„ì¹­ ë§¤ì¹­ (ì˜ˆ: "ì œì£¼" == "ì œì£¼ë„")
            if user_sido in COMPREHENSIVE_REGION_MAPPING:
                for mapped in COMPREHENSIVE_REGION_MAPPING[user_sido]:
                    if extract_sido(mapped) == target_sido:
                        return True, 0.8
    
    return False, 0.0


def is_region_specified(region_pref: List[str]) -> bool:
    """
    ì‚¬ìš©ìê°€ ì˜ë¯¸ìˆëŠ” ì§€ì—­ì„ ëª…ì‹œí–ˆëŠ”ì§€ íŒë‹¨í•©ë‹ˆë‹¤.
    
    Parameters
    ----------
    region_pref : List[str]
        ìŠ¬ë¡¯ ì¶”ì¶œëœ ì§€ì—­ ì„ í˜¸ë„ ë¦¬ìŠ¤íŠ¸
        
    Returns
    -------
    bool
        True: êµ¬ì²´ì ì¸ ì§€ì—­ì´ ëª…ì‹œë¨, False: ì§€ì—­ì´ ëª…ì‹œë˜ì§€ ì•ŠìŒ
    """
    if not region_pref:
        return False
    
    # ë¬´ì˜ë¯¸í•œ ì§€ì—­ í‘œí˜„ë“¤
    generic_regions = {
        "ì „êµ­", "ì „ì²´", "ì–´ë””ë“ ", "ì–´ë””ë‚˜", "ìƒê´€ì—†ìŒ", 
        "ëª¨ë¦„", "ëª¨ë¥´ê² ìŒ", "ë¯¸ì •", "ì•„ë¬´ê³³", "ì•„ë¬´ê³³ì´ë‚˜"
    }
    
    for region in region_pref:
        region_clean = region.strip().lower()
        
        # ë¬´ì˜ë¯¸í•œ í‘œí˜„ì´ ì•„ë‹ˆê³ , ê¸¸ì´ê°€ 2ì ì´ìƒì¸ ê²½ìš° ì˜ë¯¸ìˆëŠ” ì§€ì—­ìœ¼ë¡œ íŒë‹¨
        if region_clean not in generic_regions and len(region_clean) >= 2:
            # í•œêµ­ì˜ ì‹¤ì œ ì§€ì—­ëª… íŒ¨í„´ í™•ì¸
            if any(keyword in region_clean for keyword in [
                "ì„œìš¸", "ë¶€ì‚°", "ëŒ€êµ¬", "ì¸ì²œ", "ê´‘ì£¼", "ëŒ€ì „", "ìš¸ì‚°", "ì„¸ì¢…",
                "ê²½ê¸°", "ê°•ì›", "ì¶©ë¶", "ì¶©ë‚¨", "ì „ë¶", "ì „ë‚¨", "ê²½ë¶", "ê²½ë‚¨", "ì œì£¼",
                "ë„", "ì‹œ", "êµ°", "êµ¬"
            ]):
                return True
    
    return False


def get_progressive_region_patterns(user_regions: List[str]) -> List[Tuple[str, float, str]]:
    """
    ì ì§„ì  í™•ì¥ ê²€ìƒ‰ì„ ìœ„í•œ ì§€ì—­ íŒ¨í„´ ìƒì„±.
    
    Returns:
        [(ê²€ìƒ‰íŒ¨í„´, ê°€ì¤‘ì¹˜, ì„¤ëª…), ...]
    """
    patterns = []
    
    for user_region in user_regions:
        # 1ë‹¨ê³„: ì •í™•í•œ ì§€ì—­ëª…
        patterns.append((user_region, 1.0, f"ì •í™•ë§¤ì¹­: {user_region}"))
        
        # 2ë‹¨ê³„: ë§¤í•‘ í…Œì´ë¸”ì˜ ëª¨ë“  ë³„ì¹­
        if user_region in COMPREHENSIVE_REGION_MAPPING:
            for mapped_region in COMPREHENSIVE_REGION_MAPPING[user_region]:
                patterns.append((mapped_region, 0.9, f"ë³„ì¹­ë§¤ì¹­: {mapped_region}"))
        
        # 3ë‹¨ê³„: ì‹œë„ ë ˆë²¨ í™•ì¥
        sido = extract_sido(user_region)
        if sido and sido != user_region:
            patterns.append((sido, 0.7, f"ì‹œë„í™•ì¥: {sido}"))
    
    # ì¤‘ë³µ ì œê±° ë° ë†’ì€ ê°€ì¤‘ì¹˜ ìš°ì„ 
    unique_patterns = {}
    for pattern, weight, desc in patterns:
        if pattern not in unique_patterns or unique_patterns[pattern][0] < weight:
            unique_patterns[pattern] = (weight, desc)
    
    return [(pattern, weight, desc) for pattern, (weight, desc) in unique_patterns.items()]


def get_intelligent_region_expansion(user_regions: List[str]) -> List[Tuple[List[str], float, str]]:
    """
    ì§€ëŠ¥ì  ì§€ì—­ í™•ì¥ ì‹œìŠ¤í…œ
    ì‚¬ìš©ì ì…ë ¥ ì§€ì—­ì„ ë‹¨ê³„ë³„ë¡œ ì§€ëŠ¥ì ìœ¼ë¡œ í™•ì¥í•˜ì—¬ ê²€ìƒ‰ ë²”ìœ„ë¥¼ ë„“í˜
    
    Parameters
    ----------
    user_regions : List[str]
        ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì§€ì—­ ë¦¬ìŠ¤íŠ¸ (ì˜ˆ: ["ì¶©ì²­ë„"], ["ì¶©ë¶", "ì¶©ë‚¨"])
        
    Returns
    -------
    List[Tuple[List[str], float, str]]
        [(í™•ì¥ëœ_ì§€ì—­_ë¦¬ìŠ¤íŠ¸, ê°€ì¤‘ì¹˜, ì„¤ëª…), ...] ë¦¬ìŠ¤íŠ¸
        ê°€ì¤‘ì¹˜ê°€ ë†’ì„ìˆ˜ë¡ ì‚¬ìš©ì ì˜ë„ì— ê·¼ì ‘
    """
    expansion_levels = []
    
    for user_region in user_regions:
        # 0ë‹¨ê³„: ì •í™•í•œ ë§¤ì¹­ (ìµœê³  ê°€ì¤‘ì¹˜)
        expansion_levels.append(([user_region], 1.0, f"ì •í™• ë§¤ì¹­: '{user_region}'"))
        
        # 1ë‹¨ê³„: ì§ì ‘ ë³„ì¹­ í™•ì¥
        if user_region in COMPREHENSIVE_REGION_MAPPING:
            aliases = COMPREHENSIVE_REGION_MAPPING[user_region]
            expansion_levels.append((aliases[:5], 0.9, f"ë³„ì¹­ í™•ì¥: '{user_region}' â†’ {aliases[:3]}..."))
        
        # 2ë‹¨ê³„: ì‹œë„ ë ˆë²¨ í™•ì¥
        sido = extract_sido(user_region) 
        if sido and sido != user_region:
            expansion_levels.append(([sido], 0.8, f"ì‹œë„ í™•ì¥: '{user_region}' â†’ '{sido}'"))
            if sido in COMPREHENSIVE_REGION_MAPPING:
                sido_aliases = COMPREHENSIVE_REGION_MAPPING[sido]
                expansion_levels.append((sido_aliases[:3], 0.7, f"ì‹œë„ ë³„ì¹­ í™•ì¥: '{sido}' â†’ {sido_aliases[:2]}..."))
        
        # 3ë‹¨ê³„: ì§€ë¦¬ì  ì¸ì ‘ ì§€ì—­ í™•ì¥ (ì‹ ì¤‘í•˜ê²Œ)
        adjacent_regions = get_adjacent_regions(user_region)
        if adjacent_regions:
            expansion_levels.append((adjacent_regions[:2], 0.4, f"ì¸ì ‘ ì§€ì—­: '{user_region}' â†’ {adjacent_regions[:2]}"))
    
    # ì¤‘ë³µ ì œê±° ë° ê°€ì¤‘ì¹˜ ìˆœ ì •ë ¬
    unique_expansions = {}
    for regions, weight, desc in expansion_levels:
        key = tuple(sorted(regions))
        if key not in unique_expansions or unique_expansions[key][1] < weight:
            unique_expansions[key] = (list(regions), weight, desc)
    
    result = sorted(unique_expansions.values(), key=lambda x: x[1], reverse=True)
    
    print(f"ğŸ”„ ì§€ëŠ¥ì  ì§€ì—­ í™•ì¥ ê²°ê³¼:")
    for regions, weight, desc in result[:5]:
        print(f"   â€¢ {desc} (ê°€ì¤‘ì¹˜: {weight:.1f})")
    
    return result


def get_adjacent_regions(region: str) -> List[str]:
    """ì§€ë¦¬ì ìœ¼ë¡œ ì¸ì ‘í•œ ì§€ì—­ë“¤ì„ ë°˜í™˜ (ë³´ìˆ˜ì  ì ‘ê·¼)"""
    sido = extract_sido(region)
    if not sido:
        return []
    
    # ì§€ë¦¬ì ìœ¼ë¡œ ì¸ì ‘í•œ ì‹œë„ë“¤ (ë³´ìˆ˜ì  ë§¤í•‘)
    adjacent_mapping = {
        "ì¶©ë¶": ["ì¶©ë‚¨", "ê²½ê¸°", "ê°•ì›"],
        "ì¶©ë‚¨": ["ì¶©ë¶", "ëŒ€ì „", "ì„¸ì¢…", "ê²½ê¸°"],
        "ì¶©ì²­": ["ëŒ€ì „", "ì„¸ì¢…"],
        "ì „ë¶": ["ì „ë‚¨", "ì¶©ë‚¨", "ê²½ë‚¨"],
        "ì „ë‚¨": ["ì „ë¶", "ê´‘ì£¼", "ê²½ë‚¨"],
        "ê²½ë¶": ["ê²½ë‚¨", "ëŒ€êµ¬", "ê°•ì›"],
        "ê²½ë‚¨": ["ê²½ë¶", "ë¶€ì‚°", "ìš¸ì‚°", "ì „ë¶"],
        "ê°•ì›": ["ê²½ê¸°", "ì¶©ë¶", "ê²½ë¶"],
        "ê²½ê¸°": ["ì„œìš¸", "ì¸ì²œ", "ê°•ì›", "ì¶©ë¶", "ì¶©ë‚¨"]
    }
    
    return adjacent_mapping.get(sido, [])


def get_similar_regions(region: str) -> List[str]:
    """ê¸°ì¡´ ìœ ì‚¬ ì§€ì—­ í•¨ìˆ˜ (í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€)"""
    expansion_result = get_intelligent_region_expansion([region])
    similar_regions = []
    
    for regions, _, _ in expansion_result:  # weight, descëŠ” ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ _ë¡œ í‘œì‹œ
        similar_regions.extend(regions)
    
    # ìê¸° ìì‹  ì œì™¸ ë° ì¤‘ë³µ ì œê±°
    unique_similar = []
    for similar in similar_regions:
        if similar != region and similar not in unique_similar:
            unique_similar.append(similar)
    
    return unique_similar[:10]