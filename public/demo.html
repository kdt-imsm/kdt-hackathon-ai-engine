<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë†ì´Œ ì¼ìë¦¬Â·ê´€ê´‘ í†µí•© ì¶”ì²œ ì‹œìŠ¤í…œ - ì‹œì—°ìš© Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8f9fa;
        }
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4rem 0;
            margin-bottom: 2rem;
        }
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }
        .step {
            padding: 0.5rem 1rem;
            margin: 0 0.5rem;
            border-radius: 25px;
            background: #e9ecef;
            color: #6c757d;
            position: relative;
        }
        .step.active {
            background: #007bff;
            color: white;
        }
        .step.completed {
            background: #28a745;
            color: white;
        }
        .card-hover {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .card.selected {
            border-color: #007bff;
            background-color: #f8f9ff;
        }
        .preference-tag {
            display: inline-block;
            background: #e7f3ff;
            color: #0056b3;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            margin: 0.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .preference-tag.selected {
            background: #007bff;
            color: white;
        }
        .timeline {
            position: relative;
            padding: 1rem 0;
        }
        .timeline-item {
            position: relative;
            padding: 1rem 0;
            border-left: 2px solid #dee2e6;
            margin-left: 1rem;
            padding-left: 2rem;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 1.5rem;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #007bff;
        }
        .job-badge {
            background: #28a745;
            color: white;
            font-size: 0.75rem;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
        }
        .attraction-badge {
            background: #17a2b8;
            color: white;
            font-size: 0.75rem;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
        }
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        .demo-notice {
            background: #fff3cd;
            border: 1px solid #ffecb5;
            color: #856404;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
        }
        .preference-item {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            margin: 4px;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
            color: #333;
            font-size: 14px;
            user-select: none;
        }
        .preference-item:hover {
            border-color: #007bff;
            background: #f8f9ff;
            transform: translateY(-1px);
        }
        .preference-item input[type="checkbox"] {
            display: none;
        }
        .preference-item input[type="checkbox"]:checked + span {
            color: white;
        }
        .preference-item:has(input[type="checkbox"]:checked) {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            border-color: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <section class="hero-section text-center">
        <div class="container">
            <h1 class="display-4 fw-bold mb-3">
                <i class="fas fa-seedling me-3"></i>
                ë†ì´Œ ì¼ìë¦¬Â·ê´€ê´‘ í†µí•© ì¶”ì²œ ì‹œìŠ¤í…œ
            </h1>
            <p class="lead mb-4">AI ê¸°ë°˜ ë§ì¶¤í˜• ë†ì´Œ ì¼ì—¬í–‰ ì¶”ì²œ í”Œë«í¼ (ì‹œì—°ìš© Demo)</p>
            <div class="demo-notice">
                <i class="fas fa-info-circle me-2"></i>
                <strong>ì‹œì—° ì•ˆë‚´:</strong> ì´ í™”ë©´ì€ ê³ ì •ëœ ì‹œë‚˜ë¦¬ì˜¤ë¡œ ë™ì‘í•©ë‹ˆë‹¤. 
                í…ŒìŠ¤íŠ¸ ë¬¸êµ¬: "9ì›” ì´ˆì— 2ì£¼ ì •ë„ ì „ë¶ ê¹€ì œì—ì„œ ê³¼ìˆ˜ì› ì²´í—˜í•˜ë©´ì„œ íë§í•˜ê³  ì‹¶ì–´. ì¶•ì œë„ ìˆìœ¼ë©´ ê°€ë³´ê³  ì‹¶ì–´."
            </div>
        </div>
    </section>

    <!-- Step Indicator -->
    <div class="container">
        <div class="step-indicator">
            <div class="step active" id="step1">1. ì„ í˜¸ë„ ì„¤ì •</div>
            <div class="step" id="step2">2. ì¶”ì²œ ê²°ê³¼</div>
            <div class="step" id="step3">3. ì¼ì • ìƒì„±</div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Step 1: ì„ í˜¸ë„ ì„¤ì • + ìì—°ì–´ ì…ë ¥ -->
        <div id="preference-section" class="mb-5">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="card shadow">
                        <div class="card-body">
                            <h3 class="card-title text-center mb-4">
                                <i class="fas fa-heart text-danger me-2"></i>
                                ì„ í˜¸ë„ ì„¤ì • ë° ì—¬í–‰ ìš”ì²­ ì‚¬í•­
                            </h3>
                            
                            <!-- 1. ì§€í˜• ì„ í˜¸ë„ -->
                            <div class="mb-4">
                                <h5><i class="fas fa-mountain text-success me-2"></i>ì–´ë–¤ í’ê²½ì„ ì¢‹ì•„í•˜ì‹œë‚˜ìš”?</h5>
                                <div class="d-flex flex-wrap gap-2 mt-3">
                                    <label class="preference-item">
                                        <input type="checkbox" name="terrain" value="ì‚°">
                                        <span>ğŸ” ì‚°</span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="checkbox" name="terrain" value="ë°”ë‹¤">
                                        <span>ğŸŒŠ ë°”ë‹¤</span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="checkbox" name="terrain" value="ê°•Â·í˜¸ìˆ˜">
                                        <span>ğŸ ê°•Â·í˜¸ìˆ˜</span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="checkbox" name="terrain" value="ìˆ²">
                                        <span>ğŸŒ² ìˆ²</span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="checkbox" name="terrain" value="ë“¤íŒ">
                                        <span>ğŸŒ¾ ë“¤íŒ</span>
                                    </label>
                                </div>
                            </div>

                            <!-- 2. í™œë™ ìŠ¤íƒ€ì¼ -->
                            <div class="mb-4">
                                <h5><i class="fas fa-hiking text-info me-2"></i>ì–´ë–¤ ì—¬í–‰ ìŠ¤íƒ€ì¼ì„ ì„ í˜¸í•˜ì‹œë‚˜ìš”?</h5>
                                <div class="d-flex flex-wrap gap-2 mt-3">
                                    <label class="preference-item">
                                        <input type="checkbox" name="activity" value="íë§Â·ì—¬ìœ ">
                                        <span>ğŸ’¤ íë§Â·ì—¬ìœ </span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="checkbox" name="activity" value="ì²´í—˜í˜•">
                                        <span>ğŸ§‘â€ğŸ³ ì²´í—˜í˜•</span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="checkbox" name="activity" value="ì•¼ì™¸í™œë™">
                                        <span>ğŸš´ ì•¼ì™¸í™œë™</span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="checkbox" name="activity" value="ë¬¸í™”Â·ì—­ì‚¬">
                                        <span>ğŸ› ë¬¸í™”Â·ì—­ì‚¬</span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="checkbox" name="activity" value="ì¶•ì œÂ·ì´ë²¤íŠ¸">
                                        <span>ğŸ‰ ì¶•ì œÂ·ì´ë²¤íŠ¸</span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="checkbox" name="activity" value="ë¨¹ê±°ë¦¬ íƒë°©">
                                        <span>ğŸ´ ë¨¹ê±°ë¦¬ íƒë°©</span>
                                    </label>
                                </div>
                            </div>

                            <!-- 3. ì¼ìë¦¬ ì„ í˜¸ë„ -->
                            <div class="mb-4">
                                <h5><i class="fas fa-seedling text-warning me-2"></i>ì›í•˜ì‹œëŠ” ì¼ìë¦¬ ì¢…ë¥˜ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”</h5>
                                <div class="d-flex flex-wrap gap-2 mt-3">
                                    <label class="preference-item">
                                        <input type="checkbox" name="job" value="ê³¼ìˆ˜">
                                        <span>ğŸ ê³¼ìˆ˜</span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="checkbox" name="job" value="ì‹ëŸ‰ì‘ë¬¼">
                                        <span>ğŸŒ¾ ì‹ëŸ‰ì‘ë¬¼</span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="checkbox" name="job" value="ì±„ì†Œ">
                                        <span>ğŸ¥¬ ì±„ì†Œ</span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="checkbox" name="job" value="í™”í›¼">
                                        <span>ğŸŒ¹ í™”í›¼</span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="checkbox" name="job" value="ì¶•ì‚°">
                                        <span>ğŸ„ ì¶•ì‚°</span>
                                    </label>
                                </div>
                            </div>

                            <!-- 4. ê°„ë‹¨ ìì—°ì–´ ì…ë ¥ 5ê°œ (ì„ íƒì‚¬í•­) -->
                            <div class="mb-4">
                                <h5><i class="fas fa-comments text-primary me-2"></i>ê°„ë‹¨í•œ ìš”ì²­ì‚¬í•­ (ì„ íƒì‚¬í•­, 5ê°œê¹Œì§€)</h5>
                                <p class="text-muted small">ì…ë ¥í•˜ì§€ ì•Šì•„ë„ ë˜ë©°, ì›í•˜ëŠ” ë§Œí¼ë§Œ ì…ë ¥í•˜ì„¸ìš”</p>
                                <div class="row mt-3">
                                    <div class="col-md-6 mb-2">
                                        <input type="text" class="form-control" id="natural1" placeholder="ì˜ˆ: ì–¸ì œ ê°€ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?">
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <input type="text" class="form-control" id="natural2" placeholder="ì˜ˆ: ì–´ë””ë¡œ ê°€ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?">
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <input type="text" class="form-control" id="natural3" placeholder="ì˜ˆ: ë¬´ì—‡ì„ í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?">
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <input type="text" class="form-control" id="natural4" placeholder="ì˜ˆ: ëˆ„êµ¬ì™€ í•¨ê»˜ ê°€ì‹œë‚˜ìš”?">
                                    </div>
                                    <div class="col-12 mb-2">
                                        <input type="text" class="form-control" id="natural5" placeholder="ì˜ˆ: íŠ¹ë³„í•œ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ì‹ ê°€ìš”?">
                                    </div>
                                </div>
                            </div>

                            <div class="text-center">
                                <button class="btn btn-primary btn-lg" onclick="goToStep2()">
                                    ë‹¤ìŒ ë‹¨ê³„ <i class="fas fa-arrow-right ms-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: ìì—°ì–´ ìš”ì²­ ì…ë ¥ -->
        <div id="natural-input-section" class="mb-5" style="display:none;">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="card shadow">
                        <div class="card-body">
                            <h3 class="card-title text-center mb-4">
                                <i class="fas fa-comments text-primary me-2"></i>
                                ì›í•˜ëŠ” ì—¬í–‰ì„ ììœ ë¡­ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”
                            </h3>
                            <div class="mb-3">
                                <label class="form-label">ì–¸ì œ, ì–´ë””ì„œ, ë¬´ì—‡ì„ í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?</label>
                                <textarea 
                                    class="form-control" 
                                    id="naturalQuery" 
                                    rows="4" 
                                    placeholder="ì˜ˆì‹œ: 9ì›” ì´ˆì— 2ì£¼ ì •ë„ ì „ë¶ ê¹€ì œì—ì„œ ê³¼ìˆ˜ì› ì²´í—˜í•˜ë©´ì„œ íë§í•˜ê³  ì‹¶ì–´. ì¶•ì œë„ ìˆìœ¼ë©´ ê°€ë³´ê³  ì‹¶ì–´."
                                >9ì›” ì´ˆì— 2ì£¼ ì •ë„ ì „ë¶ ê¹€ì œì—ì„œ ê³¼ìˆ˜ì› ì²´í—˜í•˜ë©´ì„œ íë§í•˜ê³  ì‹¶ì–´. ì¶•ì œë„ ìˆìœ¼ë©´ ê°€ë³´ê³  ì‹¶ì–´.</textarea>
                            </div>
                            <div class="text-center">
                                <button class="btn btn-success btn-lg" onclick="searchRecommendations()">
                                    <i class="fas fa-search me-2"></i>
                                    ë§ì¶¤ ì¶”ì²œ ë°›ê¸°
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">ë¶„ì„ ì¤‘...</span>
            </div>
            <p class="mt-3">AIê°€ ë§ì¶¤ ì¶”ì²œì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
        </div>

        <!-- Step 3: ì¶”ì²œ ê²°ê³¼ -->
        <div id="recommendations-section" class="mb-5" style="display:none;">
            <h3 class="text-center mb-4">
                <i class="fas fa-magic text-warning me-2"></i>
                AI ë§ì¶¤ ì¶”ì²œ ê²°ê³¼
            </h3>
            
            <!-- ë†ê°€ ì¼ìë¦¬ ì¶”ì²œ -->
            <div class="mb-5">
                <h4><i class="fas fa-tractor text-success me-2"></i>ì¶”ì²œ ë†ê°€ ì¼ìë¦¬</h4>
                <div class="row" id="jobCards">
                    <!-- ë†ê°€ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ê´€ê´‘ì§€ ì¶”ì²œ -->
            <div class="mb-5">
                <h4><i class="fas fa-map-marker-alt text-info me-2"></i>ì¶”ì²œ ê´€ê´‘ì§€</h4>
                <div class="row" id="tourCards">
                    <!-- ê´€ê´‘ì§€ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <div class="text-center">
                <button class="btn btn-primary btn-lg" onclick="generateItinerary()">
                    <i class="fas fa-calendar-alt me-2"></i>
                    ì¼ì • ë§Œë“¤ê¸°
                </button>
            </div>
        </div>

        <!-- Step 4: ìƒì„±ëœ ì¼ì • -->
        <div id="itinerary-section" class="mb-5" style="display:none;">
            <h3 class="text-center mb-4">
                <i class="fas fa-calendar-check text-success me-2"></i>
                ìƒì„±ëœ ì—¬í–‰ ì¼ì •
            </h3>
            
            <div class="card shadow">
                <div class="card-body">
                    <div id="itineraryContent">
                        <!-- ì¼ì • ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-4 mt-5">
        <div class="container">
            <p>&copy; 2025 ë†ì´Œ ì¼ìë¦¬Â·ê´€ê´‘ í†µí•© ì¶”ì²œ ì‹œìŠ¤í…œ. KDT í•´ì»¤í†¤ í”„ë¡œì íŠ¸.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤
        let selectedPreferences = [];
        let jobCards = [];
        let tourCards = [];
        let selectedJobs = [];
        let selectedTours = [];

        // API ë² ì´ìŠ¤ URL
        const API_BASE = window.location.origin;

        // Step ê´€ë¦¬
        function updateStepIndicator(currentStep) {
            for (let i = 1; i <= 3; i++) {
                const step = document.getElementById(`step${i}`);
                if (i < currentStep) {
                    step.className = 'step completed';
                } else if (i === currentStep) {
                    step.className = 'step active';
                } else {
                    step.className = 'step';
                }
            }
        }

        // ì„ í˜¸ë„ í‚¤ì›Œë“œ ì„ íƒ/í•´ì œ
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.preference-tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    const keyword = this.dataset.keyword;
                    if (this.classList.contains('selected')) {
                        this.classList.remove('selected');
                        selectedPreferences = selectedPreferences.filter(k => k !== keyword);
                    } else {
                        this.classList.add('selected');
                        selectedPreferences.push(keyword);
                    }
                });
            });
        });

        // Step 2ë¡œ ì´ë™ (ìì—°ì–´ ì…ë ¥ ë‹¨ê³„)
        async function goToStep2() {
            // ì„ í˜¸ë„ ìˆ˜ì§‘
            const terrainPreferences = Array.from(document.querySelectorAll('input[name="terrain"]:checked')).map(cb => cb.value);
            const activityPreferences = Array.from(document.querySelectorAll('input[name="activity"]:checked')).map(cb => cb.value);
            const jobPreferences = Array.from(document.querySelectorAll('input[name="job"]:checked')).map(cb => cb.value);
            
            // ê°„ë‹¨ ìì—°ì–´ ì…ë ¥ ìˆ˜ì§‘ (ì„ íƒì‚¬í•­)
            const naturalInputs = [
                document.getElementById('natural1').value.trim(),
                document.getElementById('natural2').value.trim(),
                document.getElementById('natural3').value.trim(),
                document.getElementById('natural4').value.trim(),
                document.getElementById('natural5').value.trim()
            ].filter(input => input.length > 0);

            // ì „ì²´ ì„ í˜¸ë„ ì €ì¥
            selectedPreferences = [...terrainPreferences, ...activityPreferences, ...jobPreferences];
            
            // ê°„ë‹¨ ìì—°ì–´ ì…ë ¥ì´ ìˆìœ¼ë©´ ìì—°ì–´ í…ìŠ¤íŠ¸ì˜ì—­ì— ë¯¸ë¦¬ ì±„ì›Œë„£ê¸°
            if (naturalInputs.length > 0) {
                const existingQuery = document.getElementById('naturalQuery').value;
                const additionalInfo = naturalInputs.join('. ');
                document.getElementById('naturalQuery').value = existingQuery + '\n\nì¶”ê°€ ì •ë³´: ' + additionalInfo;
            }

            // Step 2 (ìì—°ì–´ ì…ë ¥)ë¡œ ì´ë™
            document.getElementById('preference-section').style.display = 'none';
            document.getElementById('natural-input-section').style.display = 'block';
            updateStepIndicator(2);
        }

        // ì¶”ì²œ ê²€ìƒ‰
        async function searchRecommendations() {
            const query = document.getElementById('naturalQuery').value.trim();
            if (!query) {
                alert('ì—¬í–‰ ê³„íšì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // Loading í‘œì‹œ
            document.getElementById('natural-input-section').style.display = 'none';
            document.getElementById('loadingSpinner').style.display = 'block';

            try {
                const response = await fetch(`${API_BASE}/demo/slots`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(query)
                });

                const data = await response.json();
                
                if (data.success) {
                    jobCards = data.job_cards;
                    tourCards = data.tour_cards;
                    
                    displayRecommendations();
                    
                    document.getElementById('loadingSpinner').style.display = 'none';
                    document.getElementById('recommendations-section').style.display = 'block';
                    updateStepIndicator(3);
                } else {
                    throw new Error(data.error || 'ì¶”ì²œ ê²€ìƒ‰ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ì¶”ì²œ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                alert('ì¶”ì²œ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                document.getElementById('loadingSpinner').style.display = 'none';
                document.getElementById('natural-input-section').style.display = 'block';
            }
        }

        // ì¶”ì²œ ê²°ê³¼ í‘œì‹œ
        function displayRecommendations() {
            // ë†ê°€ ì¼ìë¦¬ ì¹´ë“œ í‘œì‹œ
            const jobCardsContainer = document.getElementById('jobCards');
            jobCardsContainer.innerHTML = '';
            
            jobCards.forEach((job, index) => {
                const cardHtml = `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card card-hover h-100" onclick="toggleJobSelection('${job.id}', ${index})">
                            <img src="${job.image_url}" class="card-img-top" style="height: 200px; object-fit: cover;" alt="${job.title}">
                            <div class="card-body">
                                <h6 class="card-title">${job.title}</h6>
                                <p class="text-muted small mb-2">
                                    <i class="fas fa-map-marker-alt me-1"></i>${job.region}
                                </p>
                                <p class="text-muted small mb-2">
                                    <i class="fas fa-calendar me-1"></i>${job.work_date}
                                </p>
                                <p class="text-muted small mb-2">
                                    <i class="fas fa-clock me-1"></i>${job.work_hours}
                                </p>
                                <span class="job-badge">${job.crop_type}</span>
                            </div>
                        </div>
                    </div>
                `;
                jobCardsContainer.innerHTML += cardHtml;
            });

            // ê´€ê´‘ì§€ ì¹´ë“œ í‘œì‹œ
            const tourCardsContainer = document.getElementById('tourCards');
            tourCardsContainer.innerHTML = '';
            
            tourCards.forEach((tour, index) => {
                const cardHtml = `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card card-hover h-100" onclick="toggleTourSelection('${tour.id}', ${index})">
                            <img src="${tour.first_image}" class="card-img-top" style="height: 200px; object-fit: cover;" alt="${tour.name}">
                            <div class="card-body">
                                <h6 class="card-title">${tour.name}</h6>
                                <p class="text-muted small mb-2">
                                    <i class="fas fa-map-marker-alt me-1"></i>${tour.addr1}
                                </p>
                                <p class="text-muted small">${tour.overview.length > 100 ? tour.overview.substring(0, 100) + '...' : tour.overview}</p>
                                <span class="attraction-badge">ê´€ê´‘ì§€</span>
                            </div>
                        </div>
                    </div>
                `;
                tourCardsContainer.innerHTML += cardHtml;
            });
        }

        // ë†ê°€ ì„ íƒ/í•´ì œ
        function toggleJobSelection(jobId, index) {
            const card = document.querySelectorAll('#jobCards .card')[index];
            if (selectedJobs.includes(jobId)) {
                selectedJobs = selectedJobs.filter(id => id !== jobId);
                card.classList.remove('selected');
            } else {
                selectedJobs.push(jobId);
                card.classList.add('selected');
            }
        }

        // ê´€ê´‘ì§€ ì„ íƒ/í•´ì œ
        function toggleTourSelection(tourId, index) {
            const card = document.querySelectorAll('#tourCards .card')[index];
            if (selectedTours.includes(tourId)) {
                selectedTours = selectedTours.filter(id => id !== tourId);
                card.classList.remove('selected');
            } else {
                selectedTours.push(tourId);
                card.classList.add('selected');
            }
        }

        // ì¼ì • ìƒì„±
        async function generateItinerary() {
            // Demoì—ì„œëŠ” ì„ íƒê³¼ ê´€ê³„ì—†ì´ ê³ ì • ì¼ì • ìƒì„±
            try {
                const response = await fetch(`${API_BASE}/demo/itinerary`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        selected_jobs: selectedJobs.length > 0 ? selectedJobs : ['job_1', 'job_2'],
                        selected_tours: selectedTours.length > 0 ? selectedTours : ['tour_1', 'tour_2']
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    displayItinerary(data.itinerary);
                    document.getElementById('recommendations-section').style.display = 'none';
                    document.getElementById('itinerary-section').style.display = 'block';
                    updateStepIndicator(3);
                } else {
                    throw new Error(data.error || 'ì¼ì • ìƒì„± ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ì¼ì • ìƒì„± ì˜¤ë¥˜:', error);
                alert('ì¼ì • ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // ìƒì„±ëœ ì¼ì • í‘œì‹œ
        function displayItinerary(itinerary) {
            const container = document.getElementById('itineraryContent');
            
            let html = `
                <div class="text-center mb-4">
                    <h4 class="text-primary">${itinerary.title}</h4>
                    <p class="text-muted">${itinerary.period}</p>
                </div>
                <div class="timeline">
            `;

            // ë‚ ì§œë³„ë¡œ ê·¸ë£¹í™” (ìŒì‹ì  ì œì™¸)
            const scheduleByDate = {};
            itinerary.schedule.forEach(item => {
                if (item.type !== 'restaurant') {  // ìŒì‹ì ì€ ì¼ì •ì—ì„œ ì œì™¸
                    if (!scheduleByDate[item.date]) {
                        scheduleByDate[item.date] = [];
                    }
                    scheduleByDate[item.date].push(item);
                }
            });

            // ë‚ ì§œ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ í‘œì‹œ
            Object.keys(scheduleByDate).sort().forEach(date => {
                const dateObj = new Date(date);
                const formatDate = `${dateObj.getMonth() + 1}ì›” ${dateObj.getDate()}ì¼`;
                const dayOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][dateObj.getDay()];
                
                html += `<div class="timeline-item"><h5 class="text-primary">${formatDate} (${dayOfWeek})</h5>`;
                
                scheduleByDate[date].forEach(item => {
                    let badge = '';
                    let icon = '';
                    
                    switch(item.type) {
                        case 'job':
                            badge = '<span class="job-badge me-2">ë†ì—… ì²´í—˜</span>';
                            icon = '<i class="fas fa-tractor text-success me-2"></i>';
                            break;
                        case 'attraction':
                            badge = '<span class="attraction-badge me-2">ê´€ê´‘</span>';
                            icon = '<i class="fas fa-map-marker-alt text-info me-2"></i>';
                            break;
                        case 'restaurant':
                            badge = '<span class="badge bg-warning me-2">ì‹ì‚¬</span>';
                            icon = '<i class="fas fa-utensils text-warning me-2"></i>';
                            break;
                        case 'accommodation':
                            badge = '<span class="badge bg-secondary me-2">ìˆ™ë°•</span>';
                            icon = '<i class="fas fa-bed text-secondary me-2"></i>';
                            break;
                    }
                    
                    html += `
                        <div class="d-flex align-items-start mb-3">
                            <div class="me-3">
                                <div class="badge bg-primary">${item.time}</div>
                            </div>
                            <div class="flex-grow-1">
                                <h6>${icon}${item.name} ${badge}</h6>
                                <p class="text-muted small mb-1">
                                    <i class="fas fa-map-marker-alt me-1"></i>${item.address}
                                </p>
                                <p class="small">${item.description}</p>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
            });

            html += '</div>';

            // ì¶”ì²œ ìˆ™ë°•/ìŒì‹ì  ì •ë³´
            html += `
                <hr class="my-4">
                <div class="row">
                    <div class="col-md-6">
                        <h5><i class="fas fa-bed text-secondary me-2"></i>ì¶”ì²œ ìˆ™ë°•ì‹œì„¤</h5>
                        ${itinerary.accommodations.map(acc => `
                            <div class="card mb-2">
                                <div class="card-body p-3">
                                    <h6 class="card-title">${acc.name}</h6>
                                    <p class="text-muted small mb-1">${acc.addr1}</p>
                                    <p class="small">${acc.overview}</p>
                                    ${acc.tel ? `<small class="text-muted"><i class="fas fa-phone me-1"></i>${acc.tel}</small>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="col-md-6">
                        <h5><i class="fas fa-utensils text-warning me-2"></i>ì¶”ì²œ ìŒì‹ì </h5>
                        ${itinerary.restaurants.map(rest => `
                            <div class="card mb-2">
                                ${rest.first_image ? `<img src="${rest.first_image}" class="card-img-top" style="height: 120px; object-fit: cover;" alt="${rest.name}">` : ''}
                                <div class="card-body p-3">
                                    <h6 class="card-title">${rest.name}</h6>
                                    <p class="text-muted small mb-1">${rest.addr1}</p>
                                    <p class="small">${rest.overview}</p>
                                    ${rest.tel ? `<small class="text-muted"><i class="fas fa-phone me-1"></i>${rest.tel}</small>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }
    </script>
</body>
</html>